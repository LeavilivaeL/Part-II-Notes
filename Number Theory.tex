\documentclass[10pt,a4paper]{article}
\input{./preamble.tex}

\title{Number Theory}
\begin{document}
\maketitle
\section{Euclid's Algorithm}
\begin{theorem}[Division Algorithm]%fix this to be in brackets properly
Given $a, b \in \Z, b > 0$, we can determine $\exists q, r \in \Z \st a = qb+r$ with $0 \leq r <b$.
\end{theorem}
\begin{proof}
Let $S = \{a-nb : n\in\Z\}$. $S$ contains some non-negative integer. Let $r$ be the least such integer, say $a-qb$. Then $a = qb + r$, so STP $r < b$.

Suppose $b \leq r$. Then $0 < r-b = a-(q+1)b \in S$, and $r-b < r$. \contr (choice of r)
\end{proof}

If $r=0$, i.e. if $a=qb$ for some $q \in \Z$, then we write $b| a$ and say ``$b$ \emph{divides}
$a$" or ``$b$ is a \emph{divisor} of $a$". If $r\neq 0$, then we instead write $b\nmid a$ and say ``$b$ does \emph{not divide} $a$".

Given $a_1,\ldots, a_n \in \Z$ not all $0$, let $I=\{\lambda_1 a_1+\ldots+\lambda_n a_n : \lambda_i \in \Z\}$. Observe if $a,b \in I, \ell, m \in \Z$, then $\ell a + mb \in I$.

\begin{theorem}
$I = d\Z = \{dm:m\in\Z\}$ for some $d > 0$
\end{theorem}
\begin{proof}
$I$ contains some positive integer. Let $d > 0$ be the least such. Then clearly $I \supseteq d\Z$.

Conversely, let $a\in I$ and apply \textbf{1.1} to obtain $a = qd+r$ for some $q,r \in \Z$, $0\leq r < d$. Then $r=a-qd \in I \implies r = 0$, so $d\Z\supseteq I$

\therefore $\;I = d\Z$
\end{proof}

Note that $a_i \in I \forall i$, so $d| a_i \forall i$. Conversely, if $c | a_i \forall i$ then $c$ divides every element of $I$, so in particular $c | d$.

We write $d = \gcd(a_1, \ldots, a_n) = (a_1, \ldots, a_n)$, and say $d$ is the \emph{greatest common divisor} of the $a_i$.

\begin{corollary}[B\'ezout]
Let $a,b \in \Z$, $a,b$ not both $0$. Then $\exists x,y \in \Z \st ax+by=c \iff (a,b)| c$.
\end{corollary}
The division algorithm gives an efficient method for computing $(a,b)$.

\begin{theorem}[Euclid's Algorithm]
Suppose $a>b>0$. Then:
\begin{align*}
a &= q_1 b + r_1 \hspace{2cm} 0\leq r_1 < b\\
b &= q_2 r_1 + r_2 \hspace{2cm} 0\leq r_2 < r_1\\
r_1 &= q_3 r_2 + r_3 \hspace{2cm} 0\leq r_3 < r_2\\
&\hspace{.8cm}\vdots\\
r_{k-2} &= q_k r_{k-1} + r_k \hspace{2cm} r_k\neq 0\\
r_{k-1} &= q_{k+1} r_k (+0)
\end{align*}
and $r_k = (a,b)$
\end{theorem}
\begin{proof}
We have $r_k|r_{k-1} \implies \ldots \implies r_k|a, r_k|b \implies r_k|(a,b)$, so $r_k \leq (a,b)$. Note also that any $m \st m| a$ and $m| b$ also divides $r_k$. In particular, $(a,b)|r_k$, and thus $(a,b)\leq r_k$, hence $r_k = (a,b)$.
\end{proof}
Additionally, by working back up the algorithm, we can obtain a representation $(a,b) = \lambda a + \mu b$ where $\lambda, \mu \in \Z$

An integer $n>1$ is \emph{prime} if its only positive divisors are $1$ and $n$. Otherwise, we say $n$ is \emph{composite}.
\begin{corollary}
Let $p$ be a prime, $a,b \in \Z$. Then $p|ab \iff p|a$ or $p|b$
\end{corollary}
\begin{proof}
It is clear that if $p|a$ or $p|b$, then $p|ab$. Conversely, suppose $p|ab$ but $p\nmid a$. Them $(a,p) \neq p$. By definition, $(a,p)|p \implies (a,p) \in \{1,p\}$, so $(a,p)=1$. Now by \textbf{1.3} we can find $x,y\in\Z\st 1=ax+by \implies b = b(ax+py) = x(ab) + (by)p$, so $p|b$.
\end{proof}

\begin{theorem}[The Fundamental Theorem of Arithmetic]
Every integer $n>1$ can be written as a product of primes uniquely up to reordering
\end{theorem}
\begin{proof}
We have existence by strong induction.

For uniqueness, $n$ is the least integer with two distinct such representations, say $=n=p_1\ldots p_s = q_1\ldots q_r$ for $p_i, q_j$ primes.\\
Then $p_1|q_1\ldots q_r \implies p_1|q_j$ for some $j$. WLOG $j=1$. Since $p_1 > 1$ as $1$ is non-primes, $n/p_1 < n$, and $n/p_1 = p_2\ldots p_s = q_2\ldots q_r$ can be written in two distinct ways as a product of primes. \contr (choice of $n$)
\end{proof}

If $m = \Pi_{i=1}^k p_i^{\alpha_i}, n = \Pi_{i=1}^k p_i^{\beta_i}$ where $p_i$ are distinct primes, $\alpha_i, \beta_i \geq 0$, then $(m,n) = \Pi_{i=1}^k p_i^{\gamma_i}$ with $\gamma_i = \min\{\alpha_i, \beta_i\}$. However, if $m,n$ are large, it is much more ``efficient" to compute the gcd via Euclid's algorithm.

An algorithm with input $N>0$ is said to run in \emph{polynomial time} if it takes at most $c(\log N)^k$ elementary operations to complete, where $c,k > 0$ are constants independent of $N$. If the algorithm takes inputs $N_1, N_2, \ldots, N_s$, the polynomial time means $c(\max\log N_i)^k$.

Examples of polynomial time algorithms:
\begin{itemize}
\item Adding and multiplying integers
\item The gcd of two numbers via Euclid's algorithm
\item Testing of primality
\end{itemize}
On the other hand, factoring a number into prime factors does not have a polynomial time algorithm, and it is conjectured that one does not exist. For instance, if $N=p\cdot q$ with $p,q$ primes of $\sim 50$ digits each, to do trial division up to $\sqrt{N}$ at a rate of $2^9$ divisions per second, it would take approximately $\sqrt{10^{100}}/2^9$ seconds, or about $6\times 10^39$ years. However, we can compute the gcd in milliseconds using Euclid's algorithm.

\begin{theorem}
There are infinitely many primes. i.e. $\pi(x) \rightarrow \infty$ as $x\rightarrow \infty$
\end{theorem}
\begin{proof}
Fix $N>1$, let $p$ be the largest prime $\leq N$. Let $q$ be a prime factor of $M = (2\times 3\times 5 \times\ldots \times p) +1$. Then $q > N$ since $q \notin \{2,3,\ldots, p\}$, but $N$ was arbitrary.
\end{proof}

\section{Congruences}
Let $n\geq 1$ be an integer. We write $a\equiv b \mod n$ if $n|a-b$. This defines an equivalence relation on $\Z$, and we will write $\Z/n\Z$ for the equivalence classes induced by this relation, which are $a + n\Z$ for $0\leq a < n$. It is easy to check that $(a+n\Z) + (b+n\Z) = (a+b+n\Z)$ and that $(a+n\Z)\times (b+n\Z) = (ab+n\Z)$ are well defined operations, i.e $n\Z$ is an ideal, and $\Z/n\Z$ is the quotient ring. 

\begin{lemma}
Let $a \in \Z$. Then the following are equivalent:
\begin{enumerate}
\item $(a,n) = 1$
\item $\exists b\in\Z\st ab\equiv b \mod n$
\item The equivalence class of $a$ generates the group $(\Z/n\Z, +)$
\end{enumerate}
\end{lemma}

\begin{proof}\item
\begin{itemize}
\item{$(1)\implies(2)$:} $(a,n) = 1 \implies \exists b, c \in \Z \st ab+cn=1$ by \textbf{1.3}, and hence $ab \equiv 1 \mod n$.
\item{$(2)\implies(1)$:} $ab \equiv 1 \mod n \iff ab-1=kn$ for some $k \in \Z$, and so by \textbf{1.3} $(a,n) = 1$.
\item{$(2)\iff (3)$:} $ab \equiv 1 \mod n \iff 1\in \langle a\rangle \leq \Z/n\Z \iff \langle a\rangle = \Z/n\Z$
\end{itemize}
\end{proof}

We write $(\Z/n\Z)^\times$ for the set of \emph{units} (the elements with a multiplicative inverse) of $\Z/n\Z$.\\
By \textbf{2.1}, $(\Z/n\Z)^{\times}$ contains precisely those classes $a+n\Z$ such that $(a,n) = 1$. Note that if $n>1$ then $\Z/n\Z$ is a field precisely when $n$ is prime.

Let \emph{Euler's $\varphi$ function} be $\varphi(n) \coloneqq \left|(\Z/n\Z)^\times\right|$ for $n>1$, and let $\varphi(1)=1$. Observe that $\varphi(p) = p-1$ for $p$ prime. Moreover, $\varphi$ is a multiplicative function: $(m,n) = 1 \implies \varphi(mn) = \varphi(m)\varphi(n).$

\begin{corollary}
Let $G$ be a cyclic group of order $n\geq 1$. Then $\varphi(n) = |\{g\in G: \ord(g)=n\}| $, the number of generators of $G$.
\end{corollary}

\begin{theorem}[Euler-Fermat]
IF $(a,n)=1$, $a,n \in\Z$, then $a^{\varphi(n)} \equiv 1 \mod n$
\end{theorem}
\begin{proof}
By Lagrange's Theorem, the order of $a$ in the group $(\Z/n\Z)^\times$ divides the order of $(\Z/n\Z)^\times$, which is $\varphi(n)$
\end{proof}

\begin{theorem}[Fermat's Little Theorem]
If $a, p \in \Z$ and $p$ is prime, then $a^p\equiv a \mod p$.
\end{theorem}
\begin{proof}
If $p|a$, then this holds trivially. If $p\nmid a, (a,p) =1$ and so by \textbf{2.3} we have $a^{\varphi(p)} \equiv a^{p-1} \equiv 1 \mod p$
\end{proof}

\subsection*{Multiple Congruences}
Can we find all $x\in \Z \st x \equiv 4 \mod 7$ and $x \equiv 5 \mod 12$?\\
Suppose we can find $u,v\in\Z \st \begin{cases}u\equiv 1 \mod 7; & u\equiv 0 \mod 12 \\ v \equiv 0 \mod 7; & v\equiv 1 \mod 12\end{cases}$. Then we can write down that $x = 4u+5v$. Since $(7,12)=1$, by \textbf{1.3} there are some $m,n\in\Z$ with $7m+12n=1$, and from Euclid's algorithm we can determine these to be $m=-5, n=3$. Then we can find $u=12n=1-7m; v=7m=1-12n$, and substitution gives $u=36, v=-35$, and so a solution to the original problem is $4\times 36-5\times 35 = -31$. Now the lowest common multiple of $7$ and $12$ is $84$, and so our solution set is: $\{x\in\Z: x\equiv -31 \mod 84\}$.\\
We can in fact generalise this process:
\begin{theorem}[Chinese Remainder Theorem]
Let $m_1,\ldots,m_k$ be pairwise coprime positive integers, and let $M = \Pi_{i=1}^k m_i$. Then given any integers $a_1,\ldots,a_k$ there is a solution $x$ to the the system of congruences:
\begin{align*}
x &\equiv a_1 \mod m_1\\
x &\equiv a_2 \mod m_2\\
&\hspace{1cm}\vdots\\
x &\equiv a_k \mod m_k
\end{align*}
Moreover, this solution is unique modulo $M$.
\end{theorem}
Note that if $x$ satisfies this system of equations, then so does $x+tM$ for any $t\in\Z$, and so the complete set of solutions is $x+M\Z$.

\begin{proof}\item
\underline{Uniqueness:} If $x,y$ satisfy the system, then $m_i | x-y$ for all $i=1,\ldots, k$. Since no prime divides any tow the $m_i$, $M|x-y$ and hence $x\equiv y\mod M$.

\underline{Existence:} Write $M_i = \frac{M}{m_i} = \Pi_{j\neq i} m_j$ for each $i=1,2,\ldots,k$. Since $(m_i,m_j)=1 \forall i\neq j$, $(m_i,M_i) = 1$ for all $i=1,2,\ldots, k$. Therefore, for each $i=1,2,\ldots,k$ we can find $b_i \in \Z$ such that $M_i b_i \equiv 1 \mod m_i$ and $M_i b_i \equiv 0 \mod m_j$ for $j\neq i$. Then $x=\sum_{i=1}^k a_ib_iM_i$ solves the system of congruences.
\end{proof}

If $m_1,\ldots,m_k$ are pairwise coprime, and $M=\Pi m_i$, then map $\theta:\Z/M\Z\rightarrow \Z/m_1\Z \times \ldots \times \Z/m_k\Z$, taking $x \mod M \mapsto (x\mod m_1, \ldots, x\mod m_k)$ is an isomorphism of rings. To see this, note that if $m_i|M$ then $x\mod m_i$ is determined by $x\mod M$ which implies that $\theta$ is well-defined. It is a homomorphism by the properties of $+,\times$ in $\Z/n\Z$, and \textbf{2.5} implies that $\theta$ is a bijection. In particular, if $n=p_1^{\alpha_1}\ldots p_k^{\alpha_k}$ for distinct primes $p_i$, then $\Z/n\Z \cong \Z/p_1^{\alpha_1}\Z\times\ldots\times\Z/p_k^{\alpha_k}\Z$.

\begin{corollary}
If $m_1,\ldots,m_k$ are pairwise coprime and $M = \Pi_{i=1}^k m_i$ and $a_1,\ldots,a_k \in \Z$ are such that $(a_i,m_i) = 1$ for each $i=1,2,\ldots,k$, then there is a solution to the system of congruences in \textbf{2.5}, and any such solution is in fact coprime to $M$.
\end{corollary}

\begin{proof}
\textbf{2.5} gives us a solution, say $x\in\Z$. Suppose $(x,M)>1$. Then there is a prime $p$ such that $p|x$ and $p|M$ simultaneously. $p$ prime, so WLOG suppose that $p$ divides $m_1$. Since $x\equiv a_1\mod m_1$, we must have $p|a_1$, and so $p|(a_1,m_1)$ \contr.
\end{proof}

\begin{corollary}
If $m_1,\ldots, m_k$ are pairwise coprime with $M=\Pi_{i=1}^k m_i$, then $\varphi(M)=\varphi(m_1)\cdot\ldots\cdot\varphi(m_k)$
\end{corollary}
A \emph{multiplicative function} is a function $f:\N\rightarrow\C$ such that, for all $m,n \in\N$ coprime, $f(mn)=f(m)f(n)$. A function $f:\N\rightarrow\C$ is said to be \emph{totally multiplicative} if for all $m,n\in\N$, $f(m,n)=f(m)f(n)$.

Some multiplicative functions are:
\begin{itemize}
\item $\varphi(m)$
\item $\tau(n) = $ the number of positive divisors of $n$
\item $\sigma(n) = $ the sum of the positive divisors of $n$
\item $\sigma_k(n) = \sum_{d|n} d^k$, so that $\sigma_0(n) = \tau(n), \sigma_1(n) = \sigma(n)$.
\end{itemize}
None of these are totally multiplicative however.

\begin{lemma}
Let $f$ be a multiplicative function. Then so is $g$, where $g(n) = \sum_{d|n} f(d)$.
\end{lemma}
\begin{proof}
Let $m,n \in \N, (m,n)=1$. Then the divisors of $mn$ are precisely the integers of the form $d_1d_2$ where $d_1|m, d_2|n$ and $(d_1,d_2)=1$. This means that we can write down
\begin{align*}
g(mn) &= \sum_{d|mn} f(d)\\
&= \sum_{d_1|m} \sum_{d_2|n} f(d_1d_2)\\
&= \sum_{d_1|m}\sum_{d_2|n} f(d_1)f(d_2)\\
&= \sum_{d_1|m} f(d_1) \sum_{d_2|n} f(d_2)\\
&= g(m)g(n)
\end{align*} 
\end{proof}
Then if we let $f(n) = n^k$ for some $k\in\N$. Then $g(n) = \sum_{d|n} d^k = \sigma_k(n)$. Later on, we shall see that we can recover $f$ from $g$ via M\"obius inversion.

\begin{theorem}
\item
\begin{enumerate}
\item If $p$ is a prime and $m\in\N$ then $\varphi(p^m) = p^{m-1}(p-1) = p^m\left(1-\frac{1}{p}\right)$
\item $\forall n\in\N, \varphi(n)=n\cdot\Pi_{p|n}\left(1-\frac{1}{p}\right)$
\item $\sum_{d|n} \varphi(d) = n$
\end{enumerate}
\end{theorem}
\begin{proof}
\item
\begin{enumerate}
\item 
\begin{align*}
\varphi(p^m) &= \left|\{1\leq a\leq p^m : (a,p^m)=1\}\right| \\
&= p^m-p^{m-1}\\
&= p^m\left(1-\frac{1}{p}\right)
\end{align*}
\item Let $n=\Pi_{i=1}^k p_i^{\alpha_i}$ for $p_i$ distinct primes, $\alpha_1 \geq 1$. Then:
\begin{align*}
varphi(n) &= \Pi_{i=1}^k \varphi(p_i^{\alpha_i})\\
&= \Pi_{i=1}^k p_i^{\alpha_i} \left(1-\frac{1}{p_i}\right)\\
&= n\cdot\Pi_{p|n}\left(1-\frac{1}{p}\right)
\end{align*}
\item $\varphi$ is multiplicative and so is $n\mapsto n$, so it suffices to check that both sides agree when $n$ is a prime power. Let $p$ be a prime $m\in\N$. Then:
\begin{align*}
\sum_{d|p^m} \varphi(d) &= \varphi(1) + \varphi(p) +\ldots +\varphi(p^m)\\
&= 1+ (p-1) + (p^2-p) + \ldots + (p^m-p^{m-1}) \\
&= p^m
\end{align*}
\end{enumerate}
\end{proof}

Polynomials over $\Z/n\Z$ can have varying numbers of solutions, e.g.:
\begin{enumerate}
\item $x^2+2 \equiv 0 \mod 5$ has no solutions
\item $x^3 + 1 \equiv 0 \mod 7$ has three solutions
\item $x^2-1 \equiv 0 \mod 8$ has four solutions
\end{enumerate}

Let $R \in \{\Z, \Q, \Z/n\Z\}$ be a ring. Then we define $R[x]$ to be the ring of polynomials with coefficients in $R$, with addition and multiplication given in the usual way.

\textsc{Warning:} Two polynomials are \emph{equal} if their coefficients are all equal, however the map from $R[x]$ to the set of all functions $R\rightarrow R$ is not necessarily injective. For instance, if $R=\Z/p\Z$ for some prime $\Z$, then under this map $x^p-x$ is the zero function by Fermat's little theorem.

\begin{theorem}[Division Algorithm for Polynomials]
Let $f, g \in R[x]$, and suppose that the leading coefficient of $g$ is a unit (i.e. has a multiplicative inverse) in $R$. Then $\exists q, r \in R[x]$ such that $f = q\cdot g + r$ where $\deg r < \deg g$.
\end{theorem}
\begin{proof}
We prove this by induction on $n=\deg f$. If $\deg f < \deg g$, then just take $q = 0, r = f$. Otherwise, $f(x) = ax^n + \ldots; g(x) = bx^m + \ldots$ for $a, b\neq 0, n\geq m, b=c^{-1}$ for some $c\in R$.

Then define $f'(x) = f(x) - acx^{n-m}g(x)$ has degree $< n$. By the induction hypothesis, there is some $q, r \in R[x]$ such that $f'(x) = q(x)g(x) + r(x)$, with $\deg r < \deg g$.\\
But now $f(x) = (q(x) + acx^{n-m}) g(x) + r(x)$, and we are done.
\end{proof}

\begin{theorem}[Remainder Theorem]
let $f\in R[x], \alpha \in R$. Then there is some $q \in R[x]$ such that:
\begin{align*}
f(x) = (x-\alpha)q(x) + f(\alpha)
\end{align*}
\end{theorem}
\begin{proof}
By \textbf{2.10} with $g(x) = x-\alpha$, there is some $q \in R[x]$ and $r \in R$ such that $f(x) = (x-\alpha)q(x) + r$. But now $f(\alpha) = r$, and the required equality holds.
\end{proof}
A (non-zero) ring $R$ is said to be an \emph{integral domain} if it doesn't have any zero divisors, i.e. $ab=0 \iff a=0 \text{ or } b=0$. Note that $\Z$ and $\Q$ are integral domains, whilst $\Z/n\Z$ is an integral domain if and only if $n$ is prime (if $n=pq$ is a proper factorization, then $pq = 0$ in $\Z/n\Z$).

\begin{theorem}
Let $R$ be an integral domain, and let $f\in R[x]$ be a non-zero polynomial of degree $n\geq 0$. Then $f$ has at most $n$ roots in $R$.
\end{theorem}
\begin{theorem}[Lagrange]
Lt $p$ be a prime, and let $f(x)=a_n x^n+\ldots + a_1 x + a_0 \in \Z[x]$ be a polynomial of degree $n$ such that $p\nmid p$. Then the congruence $f(x) = 0 \mod p$ has  at most $n$ distinct solutions.
\end{theorem}

\begin{proof}[Of 2.12]
By induction on $n$. Check $n=0$ - trivial.

Suppose $n>0$. If $f$ has no roots the we're done. Otherwise there exists $\alpha \in R$ such that $f(\alpha) = 0$, and so by the remainder theorem, $f(x) = (x-\alpha)q(x)$ with $\deg q < \deg f = n$. So by the induction hypothesis, we know that $q$ has at most $n-1$ roots. But if $\beta \in R$ is such that $f(\beta) = 0$, then $0 = (\beta-\alpha)q(\beta)$, and since $R$ is an integral domain, we must have $\beta = \alpha$ or $q(\beta) = 0$, and so $f$ has at most $n$ roots.
\end{proof}

\emph{Example:} Let $p$ be a prime, $G = \Z/p\Z$, and let $f(x) = x^{p-1} - 1 - \Pi_{\alpha \in G} (x-\alpha)$. Observe that $\alpha = 1,2, \ldots, p-1$, then $f(\alpha) = \alpha^{p-1} - 1 \equiv 0 \mod p$, so $f$ has at least $p-1$ roots.

But $\deg f < p-1$ because the coefficient of $x^{p-1} = 0$. This means that $f$ must be the zero polynomial, and hence $0 = f(0) = -1-(p-1)! \mod p$, and we have Wilson's theorem, that $(p-1)! \equiv -1 \mod p$.

\underline{Example:} Consider $(\Z/7\Z)^\times$.\\
$3 \in (\Z/7\Z)^\times$ since $3\cdot 5 \equiv 1 \mod 7$, $3^6 \equiv 1 \mod 7$, so $3$ generates $(\Z/7\Z)^\times$, and $(\Z/7\Z)^\times$ is cyclic.

\begin{theorem}
If $p$ is a prime, then $G = (\Z/p\Z)^\times$ is cyclic and of order $p-1$.
\end{theorem}
\begin{proof}
$|G| = \varphi(p) = p-1 = \sum_{d|p-1} \varphi(d)$

By Lagrange's Theorem, $|G| = \sum_{a\mid |G|} N_a$ where $N_a = |\{g\in G : \ord(g)=d\}|$. Suppose $G$ is not cyclic, so $G$ does not contain an element of order $p-1$, so $N_{p-1} = 0 < \varphi(p-1)$, and so there must be some $d$ for which $N_d > \varphi(d)$. Let $\alpha$ be an element of order for such a $d$. Then $\langle\alpha\rangle \leq G$ is cyclic of order $d$, so it has precisely $\varphi(d)$ elements of order $d$. Since $N_d > \phi(d), \exists \beta \notin \langle\alpha\rangle \st \ord(\beta)=d$. This implies that the polynomial $x^d-1$ has $d+1$ roots, namely $1, \alpha,\ldots, \alpha^{d-1}, \beta$ \contr \textbf{2.12}.
\end{proof}

A positive integer is said to be a \emph{primitives root modulo n} if $\langle g \rangle = (\Z/n\Z)^\times$. Hence \textbf{2.14} says that primitive roots exist modulo $p$ for all primes $p$.

For instance, take $p=19$, and let $d = \ord(2)$ in $(\Z/19\Z)^\times$. Then $d|\varphi(19) = 18$, so $d=18$ or $d|6$ or $d|9$. $2^6 = 64 \nequiv 1 \mod 19$, and $2^9 = 512 \nequiv 1 \mod 19$, so $d=18$, and $2$ is a primitive room modulo $19$.

There are many open problems concerning primitive roots:
\begin{enumerate}
\item \underline{Artin's Primitive Root Conjecture:}\\
Given $g\geq 1$ does there exist infinitely many primes $p$ such that $g$ is a primitive root modulo $p$. We do know that there are infinitely many primes for which one of $\{2,3,5\}$ is a primitive root.
\item \underline{How large is the smallest primitive root modulo $p$?}\\
We can prove that it is $\leq cp^{1/4 + \epsilon}$ for some constant $c>0$ and for any $\epsilon > 0$. However, conditional on the Generalised Riemann Hypothesis (GRH), it is $\leq c\log^6 p$ for constant $c > 0$
\end{enumerate}

Now consider $(\Z/8\Z)^\times = \{\pm 1, \pm 3\}$. All of these have order $1$ or $2$, and hence $(\Z/8\Z)^\times$ is not cyclic. In fact, let $\theta: (\Z/2^k\Z)^\times \rightarrow (\Z/8\Z)^\times$ map $x \mod 2^k$ onto $x \mod 8$. Since $(a,2^k) =1 \iff (a,8) = 1$, $\theta$ is surjective. Hence, for $k\geq 3$ we have that $(\Z/2^k\Z)^\times$ is not cyclic, since a generator would map to a generator.

\begin{theorem}
If $p>2$, $(\Z/p^k\Z)^\times$ is cyclic for $k\geq 1$.
\end{theorem}
\begin{lemma}
Let $p>2, k\geq 1, y \in \Z$. Then
\begin{enumerate}
\item If $x\equiv 1+p^ky \mod p^{k+1}$, then $x^p \equiv 1+p^{k+1}y \mod p^{k+2}$
\item $(1+yp)^{p^k} \equiv 1+p^{k+1}y \mod p^{k+2}$
\end{enumerate}
\end{lemma}
\begin{proof}\item
\begin{enumerate}
\item $x^p = (1+p^ky)^p = \sum_{j=0}^p \binom{p}{j} (p^ky)^j = 1 + p^{k+1}y+\ldots+p^{pk}y^p$.

For $2\leq j\leq p-1$, $p|\binom{p}{j}$, so $\binom{p}{j}(p^ky)^j \equiv 0 \mod p^{2k+2}$, and so $\equiv 0 \mod p^{k+2}$.

Since $p\geq 2, pk\geq k+2$, so $p^{pk}y^p \equiv 0 \mod p^{k+2}$, and therefore $x^p\equiv 1+p^{k+1}y \mod p^{k+2}$

\item Let $x = 1+py$ and apply part 1 $k$ times.
\end{enumerate}
\end{proof}

\begin{lemma}
Let $p>2, k\geq 1$. If $g$ is a primitive root $\mod p$, and $g^{p-1} \nequiv 1 \mod p^2$, then $g$ generates $(\Z/p^k\Z)^\times$ for all $k\geq 1$.
\end{lemma}
\begin{proof}
Let $d = \ord g$ as a member of $(\Z/p^k\Z)^\times$. Note that $\varphi(p^k) = p^{k-1}(p-1)$, and so $d|p^{k-1}(p-1)$.

If $g$ is not a generator of $(\Z/p^k\Z)^\times$, then one of the following holds:
\begin{enumerate}
\item $d|p^{k-2}(p-1)$
\item $d=p^{k-1}e$ where $e|p-1, e\neq p-1$
\end{enumerate}
We tackle each of these cases individually, and will see that they cannot be the case:
\begin{enumerate}
\item We thus have $g^{p^{k-2}(p-1} \equiv 1 \mod p^k$. We've already seen that $g^{p-1} \equiv 1 \mod p$ and $g^{p-1} \nequiv 1 \mod p^2$, and so there exists some $y\nequiv 0$ such that $x \coloneqq g^{p-1} = 1+py$.

Then we have $x^{p^{k-2}} \equiv 1+p^{k-1}y \mod p^k \implies g^{p^{k-2}(p-1)}\equiv 1+p^{k-1}y \mod p^k \nequiv 1 \mod p^k$ \contr.

\item Here, we have $g^{p^{k-1}e} \equiv 1 \mod p^k$. Fermat tells us that $g^p \equiv g \mod p$, and so $g^{p^{k-1}} \equiv g \mod p \implies g^{p^{k-1}e} \equiv g^e \mod p$. However, $e < p$, and so this is not $1 \mod p$, and hence $g^{p^{k-1}e} \nequiv 1 \mod p$ \contr.
\end{enumerate}
Hence the only case left is that $g$ is a generator of $(\Z/p^k\Z)^\times$.
\end{proof}

\begin{proof}[Proof of 2.15]
Let $g$ be a primitive root modulo $p$. If $g^{p-1} \nequiv 1 \mod p^2$, then $(\Z/p^k\Z)^\times = \langle g \rangle \;\forall\.k\geq 1$.

Otherwise, $g^p\equiv g \mod p^2$. Let $h = (1+p)g$, so that $h^p \equiv (1+p)^p g^p \equiv g \mod p^2$. Observe that $g\nequiv h \mod p^2$, as $g$ is a primitive root modulo $p$, so that $(g,p)=1$. 

So $h^p\nequiv h \mod p^2$, and so $\langle h\rangle = (\Z/p^k\Z)^\times\;\forall\.k\geq 1$.
\end{proof}

\textbf{2.16} fails for $p=2$ because of the $k=1$ case in \textit{1.} However, it does hold if $p=2, k\geq 2$. In particular, $(1+4)^{2^{k-1}} \equiv 1+2^{k+1}\mod 2^{k+2}$. So we have $(\Z/2^k\Z)^\times = \langle -1,5\rangle \cong \Z/2^{k-2}\Z \times \Z/2\Z$ for $k\geq 3$.

\section{Quadratic Residues}
Let $p$ be an odd prime, and let $a \in \Z$ such that $a \nequiv 0\mod p$. We say that $a$ is a \emph{quadratic residue modulo p} if the congruence $x^2 \equiv a \mod p$ has a solution.  Otherwise, we say that $a$ is a \emph{quadratic non-residue modulo p}. So $a$ is a quadratic residue mod $p$ if and only if its residue class in $(\Z/p\Z)^\times$ is a square.

\begin{conjecture}[Open]
Let $n(p)$ be the least quadratic non-residue modulo $p$. We can show that $n(p) \leq cp^\theta$ for any $\theta > \frac{1}{4}\sqrt{e}$ for some constant $c>0$, and, conditional on GRH, $n(p)\leq c\log^2 p$ for some $c> 0$
\end{conjecture}

For instance, let $p=7$. We have \begin{tabular}{c|c|c|c|c|c|c}
$x$ & 1 & 2 & 3 & 4 & 5 & 6 \\ \hline
$x^2$ & 1 & 4 & 2 & 2 & 4 & 1
\end{tabular}.\\
and so the quadratic residues module $7$ are $\{1,2,4\}$, whilst $\{3,5,7\}$ are non-residues.

\begin{lemma}
Let $p$ be an odd prime. Then there are precisely $\frac{p-1}{2}$ quadratic residues modulo $p$.
\end{lemma}
\begin{proof}
Let $\sigma: (\Z/p\Z)^\times \to (\Z/p\Z)^\times; x \mapsto x^2$.

It suffices to show that $\sigma$ is $2-to-1$:
\begin{align*}
x^2 \equiv y^2 \mod p &\iff (x+y)(x-y) \equiv 0 \mod p
&\iff x \equiv \pm y \mod p
\end{align*}
as $p$ is prime and $\Z/p\Z$ is an integral domain. Hence there are precisely $\frac{p-1}{2}$ elements in the image of $\sigma$
\end{proof}
\begin{proof}[Alternative]
Let $g$ be a primitive root mod $p$, i.e. $(\Z/p\Z)^\times = \{1,g,g^2, \ldots g^{p-2}\}$, and so $\{x^2:x \in (\Z/p\Z)^\times\} = \{1,g^2,g^4,\ldots, g^{p-3}, g^{p-1}, g^{p+1}, \ldots, g^{2p-4}\}$. But $g^{p-1} \equiv 1 \mod p$, and so the second half of this set is the same as the first half, and hence only half the elements are squares.
\end{proof}

Let $p$ be an odd prime and $a\in\Z$. We define \emph{Legendre's symbol} ``$a$ on $p$" to be:
\begin{align*}
\legendre{a}{p} \coloneqq \begin{cases} 0 & p|a \\ +1 & a $ is a quadratic residue mod $p \\ -1 & a $ is not a quadratic residue mod $p\end{cases}
\end{align*}

\begin{theorem}[Euler's Criterion]
Let $p>2, a \in \Z$. Then $\legendre{a}{p} \equiv a^{\frac{p-1}{2}} \mod p$
\end{theorem}
Since $p>2$, the elements $0,1,-1$ are distinct mod $p$, so this congruence determines $\legendre{a}{p}$ uniquely.
\begin{proof}
If $a \equiv 0 \mod p$, then the result is trivial. Suppose therefore that $(a,p) = 1$. Then by Fermat, $a^{p-1} \equiv 1 \mod p$, which means that $a^{\frac{p-1}{2}} \equiv \pm 1 \mod p$. Observe further that, if $a = x^2 \mod p$, then $a^{\frac{p-1}{2}} \equiv x^{p-1} \equiv 1 \mod p$.
By \textbf{3.2}, there are precisely $\frac{p-1}{2}$ quadratic residues, so the congruence $a^{\frac{p-1}{2}} \equiv 1 \mod p$ has at least $\frac{p-1}{2}$ solutions. However, this is a polynomial in $a$ of degree $\frac{p-1}{2}$, and so it can only have at most this many solutions, and hence every solution is a quadratic residue. So whenever $\legendre{a}{p} = -1$ we must have $a^{\frac{p-1}{2}} \equiv -1 \mod p$.
\end{proof}
\begin{corollary}
Let $p>2$, $a,b \in \Z$. Then $\legendre{a}{p}\cdot \legendre{b}{p} = \legendre{ab}{p}$
\end{corollary}
\begin{proof}
\begin{align*}
\legendre{ab}{p} &\equiv (ab)^{\frac{p-1}{2}} \mod p\\
&\equiv a^{\frac{p-1}{2}}b^{\frac{p-1}{2}} \mod p\\
&\equiv \legendre{a}{p}\cdot \legendre{b}{p} \mod p
\end{align*}
\end{proof}
This implies that
\begin{enumerate}
\item The map $(\Z/p\Z)^\times \to \{\pm 1\}$; $a\mapsto \legendre{a}{p}$ is a homomorphism.
\item Let $R$ be any residue, $N$ any non-residue. Then $R\times R = R; N\times N = N; R\times N = N$
\item There is a polynomial time algorithm for computing $\legendre{a}{p}$ for odd $p$, because we can efficiently compute $a^n \mod p$ via binary modular exponentiation.
\end{enumerate}
\begin{corollary}
Let $p > 2$. Then $\legendre{-1}{p} = \begin{cases} +1 & p\equiv 1 \mod 4 \\ -1 & p\equiv -1 \mod 4\end{cases}$
\end{corollary}
\begin{proof}
$p \equiv \begin{cases} +1 & \mod 4 \\ -1 & \mod 4\end{cases} \iff \frac{p-1}{2} \equiv \begin{cases} 0 & \mod 2 \\ 1 & \mod 2\end{cases}$, \\and hence $(-1)^{\frac{p-1}{2}} \equiv \begin{cases} +1 & p\equiv 1 \mod 4\\ -1 &p\equiv 3 \mod 4\end{cases}$, and so by Euler's criterion, $\legendre{-1}{p} = (-1)^{\frac{p-1}{2}}$
\end{proof}
We can think about this in another way, by considering an alternative proof of Fermat's little theorem:\\
Observe that multiplying by $a$ simply permutes the elements of the multiplicative group mod $p$ as $a$ is a generator, hence:\\
$(p-1)! = \Pi_{j=1}^{p-1} j \equiv \Pi_{j=1}^{p-1} (aj) = a^{p-1} \Pi_{j=1}^{p-1} j = a^{p-1}(p-1)!$, and hence $a^{p-1} \equiv 1 \mod p$.

Similarly, $\Pi_{j=1}^{\frac{p-1}{2}} (aj) = a^{\frac{p-1}{2}} \Pi_{j=1}^{\frac{p-1}{2}} j = a^{\frac{p-1}{2}}(\frac{p-1}{2})!$ Write $aj \equiv \epsilon_j c_j \mod p$ with $c_j \in \{1,2,\ldots, \frac{p-1}{2}\}$, and $\epsilon_j \in \{\pm 1\}$.

We claim that, if $1\leq j \lneqq k \leq \frac{p-1}{2}$, then $c_j \neq c_k$.

Indeed, if $c_j = c_k$, then $\frac{aj}{\epsilon_j}\equiv \frac{ak}{\epsilon_k} \mod p$, i.e. $j\epsilon_k \equiv k\epsilon_j \mod p iff j \equiv \pm k \mod p$.

Hence, $a^{\frac{p-1}{2}}(\frac{p-1}{2})! = \Pi_{j=1}^{\frac{p-1}{2}}(aj) \equiv \Pi_{j=1}^{\frac{p-1}{2}} (\epsilon_j c_j) \mod p \equiv \left(\Pi_{j=1}^{\frac{p-1}{2}} \epsilon_j\right)(\frac{p-1}{2})! \mod p$, and hence $a^{\frac{p-1}{2}} \equiv \Pi_{j=1}^{\frac{p-1}{2}} \epsilon_j \mod p$. This brings us onto:

\begin{lemma}[Gauss's Lemma]
Let $p>2, a\in \Z$. Then:
\begin{align*}
\legendre{a}{p} = (-1)^\mu
\end{align*}
Where $\mu = \left|\left\{ 1\leq j\leq \frac{p-1}{2} : aj\equiv k \mod p \text{ for some } \frac{p+1}{2} \leq k \leq p-1\right\}\right|$
\end{lemma}
\begin{proof}
By the above and observe that $\mu = |\{n \leq j\leq \frac{p-1}{2} : \epsilon_j = -n \}| = |\{1\leq j \leq \frac{p-1}{2} : \epsilon_j = -1\}|$, and hence $(-1)^\mu = \Pi_{j=n}^{\frac{p-1}{2}} \epsilon_j$.
\end{proof}
\underline{Examples}
\begin{enumerate}
\item Let $a=-1$. Then $aj=-j$ for all $j \in \{1, \ldots, \frac{p-1}{2}\}$, and so $\mu = \frac{p-1}{2}$, and $\legendre{-1}{p} = (-1)^{\frac{p-1}{2}}$ as we saw in \textbf{3.5}.

\item Let $a=2$. Then $\{2j: 1 \leq j \leq \frac{p-1}{2}\} = \{2,4,\ldots, p-1\}$.\\
If $0<j<\frac{p}{4}$, then $2j \in \{1,\ldots, \frac{p-1}{2}\}$, so $\epsilon_j = 1$.\\
If $\frac{p}{4} < j <\frac{p}{2}$ then $\frac{p}{2} < 2j < p$, so $\epsilon_j = -1$.

Hence $\mu = |\{1\leq j\leq \frac{p-1}{2} : \frac{p}{4} < j < \frac{p}{2}\}| = \lfloor\frac{p}{2}\rfloor - \lfloor \frac{p}{4}\rfloor$.

The precise value depends on $p\mod 8$:
\begin{corollary}
Let $p$ be an odd prime. Then:
\begin{align*}
\legendre{2}{p} = \begin{cases} +1 & p\equiv \pm 1\mod 8 \\ -1 & p \equiv \pm 3 \mod 8 \end{cases}  = (-1)^{\frac{p^2-1}{8}}
\end{align*}
\end{corollary}

\item Let $a=3$. Consider $\{3j: 1\leq j\leq \frac{p-1}{2}\}$. We can check that $\mu = |\{1\leq j\leq \frac{p-1}{2} : \frac{p}{6} < j < \frac{p}{3}\}|$, and that it's parity depends on $p \mod 12$.
\end{enumerate}
In general, we see that $\mu = \sum_{m\in \Z} |\{1\leq j\leq \frac{p-1}{2} : (m-\frac{1}{2} \frac{p}{a} < j < m\frac{p}{a}\}|$. Observe that $0<m < \frac{1}{2} + \frac{aj}{p} < \frac{a+1}{2}$. In particular, if $a$ is odd, then $m\leq \frac{a-1}{2}$.

\begin{theorem}[Gauss's Law of Quadratic Reciprocity]
Let $p, q$ be odd primes. Then:
\begin{align*}
\legendre{p}{q}\cdot \legendre{q}{p} = (-1)^{\frac{p-1}{2}\cdot \frac{q-1}{2}}
\end{align*}
Equivalently, $\legendre{q}{p} = \begin{cases} -\legendre{p}{q} & p \equiv q \equiv 3 \mod 4 \\ \legendre{p}{q} & \ow\end{cases}$
\end{theorem}
\underline{Examples}
\begin{enumerate}
\item Let $p\geq 5$. Then $\legendre{3}{p} = (-1)^{\frac{p-1}{2}\cdot \frac{3-1}{2}} \legendre{p}{3}$. 

Now $(-1)^{\frac{p-1}{2}} = 1 \iff p \equiv 1 \mod 4$, and $\legendre{p}{3} = 1 \iff p\equiv 1 \mod 3$, so $\legendre{3}{p} = \begin{cases} +1 & p\equiv \pm 1\mod 12 \\ -1 & p \equiv \pm 5 \mod 12 \end{cases}$.

\item $\legendre{19}{73} = +1 \times \legendre{73}{19} = \legendre{16}{19} = 1$ as $16=4^2$.

\item $\legendre{34}{97} = \frac{2}{17} \times \frac{17}{97} = +1 \times \legendre{17}{97} = +1 \times \legendre{97}{17} = \legendre{12}{17} = \legendre{3}{17} = -1$ as $17 \equiv 5 \mod 12$.

\item 
\begin{align*}
\legendre{7411}{9283} &= -\legendre{9283}{7411}\\
&= -\legendre{1872}{7411}\\
&= -\legendre{13}{7411} \text{ as $1872=2^4\cdot 3^2\cdot 13$, and $2, 4$ are even powers}\\
&= -\legendre{7411}{13}\\
&= -\legendre{1}{13}\\
&= -1
\end{align*}
\end{enumerate}
\begin{proof}[Proof of Gauss's Lemma]
$\legendre{q}{p}=(-1)^\mu$ where $\mu = |\{(j,m) \in S : (m-\frac{1}{2})\frac{p}{q} < j < m\frac{p}{q}\}|$ where $S = \{(j,m) : 1\leq j\leq \frac{p-1}{2}, 1 \leq m \leq \frac{q-1}{2}\}$.

Rewriting, $\mu = |\{(j,m) \in S : 0 < mp-jq < \frac{p}{2}\}|$.\\
Similarly, $\legendre{p}{q} = (-1)^\eta$, where $\eta = |\{(j,m) \in S : 0 < jq - mp < \frac{q}{2}\}|$.

Observe that $\legendre{q}{p} \legendre{p}{q} = (-1)^{\mu+\eta}$. Now $|S| = \frac{p-1}{2}\frac{q-1}{2} = \mu + \eta + |A| + |B|$, where:
\begin{align*}
A &= \{(j,m)\in S : mp-jq > \frac{p}{2}\}\\
B &= \{(j,m)\in S : jq-mp > \frac{q}{2}\}
\end{align*}
Given $(j,m) \in S$, let $j' = \frac{p+1}{2}-j, m' = \frac{q+1}{2}-m$. Note that $(j',m') \in S$. We now claim that $(j,m) \in A \iff (j', m') \in B$.

Indeed, note that $j'q-m'p = (\frac{p+1}{2}-j)q - (\frac{q+1}{2}-m)p = mp-jq-\frac{p}{2}+\frac{q}{2}$. Hence $j'q-m'p > \frac{q}{2} \iff mp-jq > \frac{p}{2}$.

Hence $|A| = |B|$, and so these terms do not affect the sign of $(-1)^{\mu+\eta + |A|+|B|}$, and hence:
\begin{align*}
\legendre{p}{q}\legendre{q}{b} = (-1)^{\mu+\eta}=(-1)^{\frac{p-1}{2}\frac{q-1}{2}}
\end{align*}
\end{proof}

This is a very powerful theorem, however in example 4., we still had to factorise 1872 which is, in general, very hard to do. To get around this problem, we will extend the Legendre symbol.

Given $n \geq 1$ an odd number, and $n=p_1 \cdot \ldots p_k$ where the $p_k$ are not necessarily distinct, we can define the \emph{Jacobi symbol} $\jacobi{a}{m} = \Pi_{i=1}^k \legendre{a}{p_1}$, and $\jacobi{a}{1} = 1$. Note that if $(a,n)=1$ then $\jacobi{a}{n} = 0$.

\begin{proposition}
Let $m,n \geq 1$ be odd, and let $a,b \in \Z$. Then:
\begin{enumerate}
\item If $a \equiv b \mod n$, then $\jacobi{a}{n} = \jacobi{b}{n}$
\item $\jacobi{ab}{n} = \jacobi{a}{n}\jacobi{b}{n}$ and $\jacobi{a}{mn} = \jacobi{a}{m}\jacobi{a}{n}$
\item $\jacobi{-1}{n} = (-1)^{\frac{n-1}{2}}$
\item $\jacobi{2}{n} = (-1)^{\frac{n^2-1}{8}}$
\end{enumerate}
\end{proposition}
\begin{proof}\item
\begin{enumerate}
\item Note that if $a\equiv b \mod n$, then $a\equiv b\mod p_i$ for all $i$ by the Chinese remainder theorem, and hence $\jacobi{a}{p_i} = \jacobi{b}{p_i}$.
\item $\jacobi{ab}{p} = \jacobi{a}{p}\jacobi{b}{p}$ for each odd prime $p$, and so the first part follows from the definition. The second part is immediate from the definition.
\item This is true for $n$ prime, and so by \textit{2.} it is sufficient to check that if $m,n$ are odd, then $(-1)^{\frac{m-1}{2}}(-1)^{\frac{n-1}{2}} = (-1)^{\frac{mn-1}{2}}$ and $(-1)^{\frac{m^2-1}{8}}(-1)^{\frac{n^2-1}{2}}=(-1)^{\frac{m^2n^2-1}{2}}$. 
\end{enumerate}
\end{proof}

\begin{theorem}[Quadratic Reciprocity for Jacobi Symbols]
Let $m,n \geq 1$ be odd. Then:
\begin{align*}
\jacobi{m}{n} = (-1)^{\frac{m-1}{2}\frac{n-1}{2}}\jacobi{n}{m}
\end{align*}
If $(m,n) = 1$, then $\jacobi{m}{n}\jacobi{n}{m} = (-1)^{\frac{m-1}{2}\frac{n-1}{2}}$
\end{theorem}
\begin{proposition}
If $(m,n) > 1$, then both sides are $0$ and we're done.

Suppose $(m,n) = 1$, with $m = \Pi_{i=1}^k p_i$, $n=\Pi_{j=1}^\ell q_j$, with the $\{p_i\}, \{q_j\}$ not necessarily distinct but $\{p_i\}\cap\{q_j\} = \emptyset$.

Then:
\begin{align*}
jacobi{m}{n} &= \Pi_{i=1}^k \Pi_{j=1}^\ell \jacobi{p_i}{q_j} \\
&= \Pi_{i=1}^k \Pi_{j=1}^\ell (-1)^{\frac{p_i-1}{2}\frac{q_j-1}{2}} \jacobi{q_j}{p_i} \\
&= (-1)^{rs} \Pi_{i=1}^k \Pi_{j=1}^\ell \jacobi{q_j}{p_i} \\
&= (-1)^{rs} \jacobi{n}{m}
\end{align*}
where $r = |\{i: p_i \equiv 3 \mod 4\}|, s = |\{j: q_j \equiv 3 \mod 4\}|$.

But $\frac{m-1}{2}\frac{n-1}{2}\equiv 1 \mod 2 \iff m\equiv n\equiv 3 \mod 4 \iff r\equiv s \equiv 1 \mod 2$, and hence the result follows.
\end{proposition}

\textsc{Important Remark:} Let $p$ be an odd prime and $a \in \Z$ with $(a,b)=1$. Then $\jacobi{a}{p} = 1$ if and only if $a$ is a square mod $p$, however this is not the case in general for composite $n$:

Let $n$ be an odd integer, and let $a \in Z$ with $(a,n) = 1$. Then if $a$ is a square mod $n$, say $a=x^2 \mod n$, then $\jacobi{a}{n} = \jacobi{x^2}{n} = \jacobi{x}{n}^2 = 1$. The converse is \textsc{not} the case: $\jacobi{2}{15} = \jacobi{2}{3}\cdot \jacobi{2}{5} = 1$, but $2$ is not a square mod $15$.

More generally, let $p\neq q$ be odd primes, and $a \in \Z$ with $(a, pq)=1$. Then by the Chinese Remainder Theorem:
\begin{center}
$a$ is a square mod $pq$ if and only if $a$ is a square mod $p$ and mod $q$.
\end{center}
Then if $\jacobi{a}{pq}=-1$, then $a$ is not a square mod $pq$, but if $\jacobi{a}{pq}=+1$ then all we know is $\jacobi{a}{p} = \jacobi{a}{q}$.

\underline{Examples:}
\begin{enumerate}
\item $\jacobi{33}{73} = \jacobi{73}{33} = \jacobi{7}{33} = \jacobi{33}{7} = \jacobi{5}{7}=-1$.
\item $\jacobi{66}{73} = \jacobi{2}{73}\jacobi{33}{73} = -1$
\end{enumerate}
\section{Binary Quadratic Forms}
Which integers can be represented as the sum of two integer squared?
\begin{theorem}
Let $N \in \N$. Then $N$ is the sum of two squares if an only if every prime $p \equiv 3 \mod 4$ divides $N$ to some even power. 
\end{theorem}
\begin{proof}
Suppose $N=x^2+y^2$, and $p|N, p \equiv 3 \mod 4$. 

Then $x^2 \equiv -y^2 \mod p$ and $\legendre{-1}{p}=-1$, and so we must have $x \equiv y \equiv 0 \mod p$. Hence $p^2 | N$. Now repeat the argument with $(N/p^2, x/p, y/p)$ until $p\nmid N$.

Conversely, write $N=M^2 K$ where $K$ is the product of distinct primes, each either $2$ or congruent to $1 \mod 4$. Then it suffices to show that we can represent $K=x^2+y^2$ with $x,y \in \Z$ since then $N = (Mx)^2 +(My)^2$. Now observe $(x^2+y^2)(z^2+w^2) = (xz-yw)^2 + (xw+yz)^2$, and $2=1^2+1^2$, it is enough to show that a prime $p \equiv 1 \mod 4$ can be written as a sum of two squares. We will show this next week.
\end{proof}

A \emph{binary quadratic form} with integer coefficients is of the form $f(x,y) = ax^2 + bxy + cy^2$ for $a,b,c \in \Z$. We say that \emph{f represents n} for $n \in \N$ if there are integers $x,y$ such that $n = f(x,y)$. We sometimes write $(a,b,c)$ in place of $f$.

It can also be helpful to regard $f$ as a matrix:
$f(x,y) = \begin{pmatrix}
x & y
\end{pmatrix} \begin{pmatrix}
a & b/2 \\ b/2 & c
\end{pmatrix} \begin{pmatrix}
x \\ y
\end{pmatrix}$

A \emph{unimodular substitution} is a change of variable of the form $X = \alpha x + \gamma y; Y = \beta x + \delta y$ with $\alpha, \beta, \gamma, \delta \in \Z$ and $\alpha\delta-\beta\gamma=1$. We say that two binary quadratic forms $f$ and $g$ are \emph{equivalent} if $f(X,Y) = g(x,y)$ for some unimodular substitution $(x,y) \mapsto (X,Y)$. Note that equivalence of binary quadratic forms is an equivalence relation (example sheet).

Note that the set of unimodular substitutions is $SL_2(\Z)$, a group under matrix multiplications acting on the set of binary quadratic forms via unimodular substitutions. The orbits of this action are precisely the equivalence classes of binary quadratic forms. To see that this is a group action, we need to check that $I \cdot f = f$ and $A\cdot (B\cdot f) = (AB)\cdot f$.

Note that if $f = (a,b,c)$ and $Af = g = (a',b',c')$, one can check via manual substitution that $\begin{pmatrix}
a' & b'/2 \\ b'/2 & c' \end{pmatrix} = A \begin{pmatrix}
a & b/2 \\ b/2 & c
\end{pmatrix}
A^T$.

The \emph{discriminant} of a binary quadratic form $(a,b,c)$ is defined to be $\disc f = b^2-4ac = -4 \det \begin{pmatrix}a & b/2 \\ b/2 & c\end{pmatrix}$.

\begin{lemma}
Equivalent BQFs have the same discriminant.
\end{lemma}
\begin{proof}
If $g=Af$, then:
\begin{align*}
\disc g &= -4 \det (A M A^T) \\
&= -4 \det M \det A \det A^T \\
&= -4 \det M \\
&= \disc f
\end{align*}
\end{proof}

Note that BQFs can have the same discriminant and not be equivalent, e.g. $x^2 + 6y^2$ and $2x^2+3y^2$ both have discriminant $-24$.
\begin{lemma}
There exists a BQF $f$ with $\disc f = d$ if and only if $d\equiv 0$ or $1 \mod 4$.
\end{lemma}
\begin{proof}
If $d \equiv 0 \mod 4$ take $f = (1,0,-d/4)$. If $d\equiv 1 \mod 4$ take $f = (1,1 \frac{1-d}{4})$. For the other direction note $0, 1$ are the only squares mod $4$.
\end{proof}

A real quadratic form given by $f(x_1, \ldots, x_n) = \sum_{i\leq j} a_{ij} x_i x_j$ with $a_{ij} \in \R$ is said to be:
\begin{itemize}
\item \emph{Positive definite} if $f(x) > 0$ for $x \in \R^n\setminus\{0\}$
\item \emph{Negative definite} if $f(x) < 0$ for $x \in \R^n\setminus\{0\}$
\item \emph{Indefinite} if there are $x, y \in \R^n$ such that $f(x) > 0 > f(y)$.
\end{itemize}
We will stick to $n = 2, a_{ij}\in \Z$, but the definitions are just the same.
\begin{lemma}
Let $f = (a,b,c)$ be a BQF, and let $d = \disc f = b^2 - 4ac$. Then the following hold:
\begin{enumerate}
\item If $d < 0$ and $a > 0$ then $f$ is positive definite.
\item If $d < 0$ and $a < 0$ then $f$ in negative definite.
\item If $d > 0$ then $f$ is indefinite.
\item If $d = 0$ then $f(x,y) = \ell(mx+ky)^2$ for some $\ell, m, k \in \Z$.
\end{enumerate}
\end{lemma}
\begin{proof}
\item 
\begin{itemize}
\item[\textit{1.}, \textit{2.}] $4af(x,y) = 4a^2x^2 + 4abxy + 4acy^2 = (2ax+by)^2 - b^2y^2 + 4acy^2 = (2ax+by)^2 - dy^2$, where $d = \disc f$. So if $d < 0$ then $4af(x,y) \geq 0$ for all $x,y \in \R$. If it $=0$ then $x=y=0$, and so if $a>0$ then $f$ is positive definite and if $a<0$ then $f$ is negative definite.
\item[\textit{3.}] Suppose $d > 0$. As above, $4af(x,y) = (2ax+by)^2-dy^2 = (2ax+by-\sqrt{d}y)(2ax+By+\sqrt{d}y) = 4a^2(x+\frac{b-\sqrt{d}}{2a}y)(x+\frac{b+\sqrt{d}}{2a}y)$. Hence we can get get positive or negative values for $4af$, and hence for $f$.
\item[\textit{4.}] Write $a = a_1a_2^2$ with $a_1$ a product of distinct primes. Then $ax^2 + bxy+cy^2 = a_1(a_2x + \frac{b}{2a_1a_2}y)^2$ is of the desired form.
\end{itemize}
\end{proof}
Note that there are indefinite forms all of whose coefficients are positive, e.g. $\disc(1,3,1) = 520 > 0$. There are also positive definite forms not all of whose coefficients are positive. So $\disc(1,-1,2) = -7 < 0$. Note that $d < 0$ and $a>0$ implies that $c>0$, so the only coefficient that can be negative is the middle one.

\underline{Example:} Consider $(10,34,29)$. The coefficients here are large and awkward - it would be nice to move to an equivalent BQF with smaller coefficients. If $f(x,y) = ax^2 + bxy + cy^2$, consider what happens with the substitution given by $x' = x+ \lambda y, y' + y$. Then we have $f(x', y') = g(x, y) = ax^2 + (b+2\lambda a) xy + (\lambda^2a + \lambda b +c)y^2.$

Hence $(a,b,c) \thicksim (a, b\pm 2a, a\pm b + c)$ with $\lambda = \pm 1$, and in our case $(10, 34, 29) \thicksim (10, 14, 5) \thicksim (10,-6,1).$

Another nice substitution is $x' = y, y' = -x$. This gives $(a,b,c) \thicksim (c, -b, a)$

So in our example, we get $(10, 34, 29) \thicksim (1, 6, 10) \thicksim (1, 4, 5) \thicksim (1, 2, 2) \thicksim (1, 0, 1)$, which is very nice. 

A positive BQF is said to be \emph{reduced} or \emph{in reduced form} when either $-a < b \leq a < c$ or $0 \leq b \leq a = c$. Note that in either case $|b| \leq a \leq c$.

The form that we ended up with at the end of the previous discussion, $(1,0,1)$ is reduced by the second criterion.

\begin{proposition}
Every positive definite BQF is equivalent to a reduced form.
\end{proposition}
\begin{proof}
Consider the operations:
\begin{align*}
T_{\pm}:(a,b,c)&\mapsto (a, b\pm 2a, a\pm b +c)\\
S:(a,b,c)&\mapsto (c, -b, a)
\end{align*}
If $a>c$, we use $S$. Otherwise, if $a \leq c$ and $c \leq |b|$, then use $T_{\pm}$ to reduce $|b|$. At each stage, observe that $|a|+|b|$ decreases by at least $1$, so this algorithm will terminate. As such, eventually we must have that $a \leq c$ and $|b| \leq a$. Then, if $a <c$ then $b = -a$ if $a$ is not reduced. Hence $(a,b,c) = (a,-a,c) \thicksim (a,a,c)$, reduced. If $a =c$, then $-a \leq b < 0$, and so $(a,b,a) \thicksim (a,-b,a)$, reduced.
\end{proof}

\begin{lemma}
Let $f = (a,b,c)$ be a reduced PDBQF (positive definite binary quadratic form) with discriminant $d$. Then $|b| \leq a \leq \sqrt{\frac{|d|}{3}}$, and $b \equiv d \mod 2$.
\end{lemma}
\begin{proof}
$b\equiv d \mod 2$ is trivial, as $4 \equiv 0 \mod 2$. So $f$ reduced implies that $|b| \leq a \leq c \implies d = b^2-4ac \leq -3ac \leq -3a^2$, and hence $a \leq \sqrt{\frac{|d|}{3}}$.
\end{proof}
For instance, if $f$ is a PDBQF with discriminant $-4$, then $f \thicksim (1,0,1)$. This seemingly simply lemma will prove to be immensely useful.

\begin{proof}[Proof of 4.1, continued.]
We need to show that, if $p \equiv 1 \mod 4$, then we can write $p = x^2 + y^2$ for some $x,y \in \Z$.

Observe that $\legendre{-1}{p} = 1$, and hence there are $m,k \in \Z$ with $m^2 = -1 + pk$. Now if we let $f = (p, 2m, k)$, then $f(1,0) = p$ so $f$ represents $p$, and $\disc f = -4$, so $f \thicksim (1,0,1)$, and hence $x^2+ y^2$ also represents $p$.
\end{proof}
We say that a BQF \emph{properly represents} $n \in \Z$ if $\exists x,y \in \Z \st \gcd(x,y) = 1$ and $n= f(x,y)$. Observe that if there is a unimodular substitution $(x,y)\leftrightarrow (X,Y)$, then $d|(x,y) \iff d|(X,Y)$, and hence equivalent BQFs properly represent the same integers.

\begin{lemma}
The least properly represented positive integers by a PDBQF are $a, c, a-|b|+c$.
\end{lemma}
\begin{proof}
If $f(x,y) =n$ properly, then $(x,y) = 1 \implies x = \pm 1$ and $f(\pm 1, 0) = a$, and similarly $f(0,\pm 1) = c$.

Suppose then that $|x| \geq |y| > 0$. Then $f(x,y) = ax^2 + bxy +cy^2 \geq a - |b|+c \geq c$. We have a similar result if $|y| \geq |x| > 0$.

But then for a suitable choice of $\epsilon \in \{\pm 1\}$, we see $f(1,\epsilon) = a - |b|+c$.
\end{proof}
Note that values in the above are repeated if represented by more than one way not counting the trivial $f(x,y) = f(-x,-y)$.

\begin{theorem}
Every PDBQF is equivalent to a unique reduced form. (i.e. e ach reduced form represents a distinct equivalence class).
\end{theorem}
\begin{proof}
We already have existence, so it is sufficient to prove that no two reduced forms are equivalent, or that if two reduced forms are equivalent they must be the same, so suppose $f,g$ are both reduced, and $(a,b,c) = f \thicksim g = (a',b',c')$.

Note that the least value properly represented by $f, g$ is $a, a'$ say. Hence $a = a'$ and similarly $c = c'$. Now by considering discriminants we have $b = \pm b'$. If $b = 0$, we are immediately done, so suppose $0<b = -b'$. Note that we must have the $-a<b<a<c$, by considering the reduced conditions for both BQFs.

So we have $a<c<a - |b|+c$, and there are no repeats. Since $g(x,y) = f(X,Y)$ for some unimodular substitution represented by $A = \begin{pmatrix}
\alpha & \beta \\ \gamma & \delta
\end{pmatrix} \in SL_2(\Z)$, we manually have $\alpha, \delta = \pm 1; \beta, \gamma = 0$, and so $A = \pm I$. Observe that we cannot have the $-$ case, and so $g = f$ as required.
\end{proof}

Let $d < 0, d \equiv 0$ or $1 \mod 4$, we define the \emph{class number} $h(d)$ as the number of reduced BQFs of discriminant $d$. For instance, we have seen that $h(-4) = 1$. Consider $d=-24$: the forms $(1,0,6)$ and $(2,0,3)$ have discriminant $-24$ and are reduced. One can show that there re no others, and so $h(-24) = 2$. 

One might ask how $h(d)$ behaves as a function. We know that:
\begin{enumerate}
\item $h(d) \to \infty$ as $d \to \infty$
\item $h(d) \approx \sqrt{d}$, i.e. $\frac{1}{N}\sum_{3\leq -d \leq N} h(d) \thicksim \frac{\pi}{18}N^{1/2}$ as $N \to \infty$.
\item $h(d) - 1 \implies d \in \{-3,-4,-7,-8,-11,-19,-43,-67,-163,-12,-16,-27,-28\}$
\item Given $h \geq 1$, there is an explicit upper bound the set of all $\{d:h(d) = h\}$. So in principle we can compute all $d$ with a given class number $h$.
\end{enumerate}
\begin{lemma}
Let $n \in \N$, and $f$ a BQF. then $n$ is properly represented by $f$ if and only if $f \thicksim g = (a,b,c)$ with $a = n$
\end{lemma}
\begin{proof}
If $f \thicksim g = (n,b,c)$, then $g(1,0) = n$

Conversely, if $f(\alpha,\beta) = n$ for some $\alpha, \beta \in \Z, (\alpha,\beta) = 1$, then there exists some $\delta, \gamma \in \Z \st \alpha\delta-\beta\gamma = 1$. Hence $f$ is equivalent to $g(x,y) = f(\alpha x +\gamma y, \beta x+\delta y)$. But the first coefficient of $g$ is $g(1,0) = f(\alpha,\beta) = n$.
\end{proof}

\begin{theorem}
Let $n \in \N$ and $d < 0$ with $d \equiv 0$ or $1 \mod 4$. Then $n$ is properly represented by \textit{some} BQF of discriminant $d$ if and only if $x^2 \equiv d \mod 4n$ has a solution.
\end{theorem}
\begin{proof}
If $n = f(x,y)$ with $x,y \in \Z, (x,y) = 1, \disc f = d$ then the previous lemma gives $f \thicksim g=(n,b,c)$. Then $b^2-4nc = d$, and so $b^2 \equiv d \mod 4n$.

Conversely, if $\exists b \in \Z \st b^2 \equiv d \mod 4n$, then $\exists c \in \Z \st b^2 = d+4nc \implies d = b^2-4nc$, so $(n,b,c)$ is as required. 
\end{proof}
\underline{Example:} Which integers are properly represented by $x^2+xy+2y^2$? Note that $\disc f = -7 < 0$. If $(a,b,c)$ is a reduced for discriminant $-7$, then $|b| \leq a \leq 1$ and $b$ odd, hence $a = |b| = 1$, and $c = \frac{b^2-d}{4} = 2$. Hence $(a,b,c) = (1,1,2)$ as $(1,-1,2)$ is not reduced. So $f$ properly represents $n$ if and only if $x^2 \equiv -7 \mod 4n$ has solutions.

Suppose $n$ is prime, i.e. $n=p \notin \{2,7\}$. Then by $x^2 \equiv -7 \mod 4p$ if and only if $x^2 \equiv -7 \mod 4$ and $x^2 \equiv -7 \mod p$. Then this system holds if and only if $\legendre{-7}{p} = 1$. Now $\legendre{-7}{p} = \legendre{p}{7}$, i.e. $p \equiv 1, 2, 4 \mod 7$. Note that $f(0,1) = 2$ and $f(1,-2) = 7$.

Suppose $n$ is composite, i.e. $n = \Pi p^{\alpha_p}$ for $p$ distinct primes, $\alpha_p \geq 0$. Then $x^2 \equiv -7 \mod 4n$ is soluble if and only if $x^2 \equiv -7 \mod 2^{2+\alpha_2}$ and $x^2 \equiv -7 \mod p^{\alpha_p}$ for odd $p$ is soluble.

\begin{lemma}[Hensel, only a special case]
Let $a \in \Z$.
\begin{enumerate}
\item If $a \equiv 1 \mod 8$ then $x^2 \equiv a \mod 2^k$ for all $k \geq 1$ is soluble.
\item If $p > 2$ is prime and $\legendre{a}{p} = 1$ then $x^2 \equiv a \mod p^k$ is soluble for all $k \geq 1$.
\end{enumerate}
\end{lemma}

Note then that $-7 \equiv 1 \mod 8$, so the first equation is soluble. If $p$ is odd, then $p \equiv 1, 2, 4\mod 7$ then $\legendre{-7}{p} = 1$, and so $x^2 \equiv -7 \mod p^k$ is soluble for all $k\geq 1$. If $p = 7$, then $x^2 \equiv -7 \mod 7^k$ is soluble when $k \leq 1$ but not when $k \geq 2$.

In conclusion, $f = (1,1,2)$ properly represents $n$ if and only if $n = 7^{\alpha_7} \Pi_{p \equiv 1,2,4 \mod 7} p^{\alpha_p}$ where $\alpha_p \geq 0$, and $\alpha_7 \in \{0,1\}$.

The numbers represented by $f$ not necessarily properly are then of the form $k^2 n$ with $k\geq 1$ and $n$ as above. In other words, $n = x^2 + xy + 2y^2$ for some $x,y \in \Z$ if and only if every prime $p \equiv 3,5,6 \mod 7$ dividing $n$ divides it to an even power.

\begin{proof}[Proof of Hensel.]
\begin{itemize}
\item[\textit{1.}] By induction on $k$. The case $k \leq 3$ is clear - taking $x = 1$ will do. So suppose there exists some $x$ such that $x^2 \equiv a \mod 2^k$, i.e. $x^2 = a + 2^k m$ for some $m \in \Z, k \geq 3$. Note that:
\begin{align*}
(x+2^{k-1})^2 = x^2 + 2^k x + 2^{2k-2} \equiv a + 2^k(x+m)  \mod 2^{k+1}
\end{align*}
If $m$ is even then $x^2 \equiv a \mod 2^{k+1}$\\
If $m$ is odd then since $x$ is odd, $(x+2^{k-1})^2 \equiv a \mod 2^{k+1}$.

\item[\textit{2.}] Since $\legendre{a}{p}=1$, $x^2 \equiv a \mod p$ is soluble, so we have a base case. Assume that there is some $x$ such that $x^2 \equiv a \mod p^k$ for some $k \geq 1$. Then for $t \in \Z$, we have:
\begin{align*}
(x+tp^k)^2 &= x^2 + 2txp^k + t^2 p^{2k}\\
&= a + (2tx + m)p^k + t^2p^{2k}\\
&\equiv a + (2tx+m)p^k \mod p^{k+1}
\end{align*}
Since $(x,p) = 1$, there is some $t$ such that $2xt+m \equiv 0 \mod p$, and for this $t$ we have $(x+p^k t)^2 \equiv a \mod p^{k+1}$.
\end{itemize}
\end{proof}
\underline{Remarks:}
\begin{enumerate}
\item If $h(d) = 1$ we have completely solved the problem of which integers are represented by a given form of discriminant $d \leq 0$. If $h(d) > 1$, we can determine which integers are represented by some form of discriminant $d$, but in general we cannot do better. For some $d$ we can distinguish using additional congruence conditions, but there is no congruence condition to tell if e.g. $p = x^2 + 23y^2$.
\item An integer $d \equiv 0$ or $1 \mod 4$ is said to be a \emph{fundamental discriminant} if it is not of the form $k^2 d'$ for some $k>1, d' \equiv 0$ or $1 \mod 4$. For a fundamental discriminant, Gauss defined a law of composition which makes the set of BQFs of divisor $d$ into an abelian group. The group is known as the \emph{ideal class group} of the field $\Q(\sqrt{d})$. More will come later on this in Number Fields.
\item If $f$ is definite, then there are only a finite number of representations of $n$ by $f$. e.g. $n = x^2 + y^2 \implies |x|, |y| \leq \sqrt{n}$. If $f$ is indefinite, there can be infinitely many representations.
\end{enumerate}
What about quadratic forms in more than two variables?
\begin{theorem}[Lagrange, 1770]
Every possible integer can be written as the sum of four squares
\end{theorem}
\begin{theorem}[Legendre, 1797]
A positive integer $n$ can be written as the sum of three squares if and only if $n \nequiv 4^a \mod (8b+7)$ for some $a,b \geq 0$.
\end{theorem}

In 1770 Waring posed the following problem: For every $k$, let $g(k)$ be the least integer integer such that every positive integer can be written as a sum $k$-th powers. Hilbert showed in 1909 that $g(k)$ exists for all $k$. Lagrange showed $g(2) = 4$, and it is known that $g(3) = 9, g(4) = 19$. The asymptotic behaviour remains an open question.

\section{The Distribution of Primes}
We now turn to questions about how primes occur. How many are there? How quickly to they appear? How densely do they come? How regular is the sequence of primes?

\begin{theorem}[Prime Number Theorem]
Let $\pi(x)$ be the number of primes less than or equal to $x$. Then $\pi(x) \thicksim \frac{x}{\log x}$ as $x \to \infty$. More precisely, $\pi(x) = \frac{x}{\log x} + O(x \exp(-\sqrt{\log x}))$
\end{theorem}
This is sometimes stated in terms of the logarithmic integral $Li(x) = \int_2^x \frac{dt}{\log t}$:  $\pi(x) \thicksim Li(x)$.

\begin{theorem}[Dirichlet's Theorem on Primes in Arithmetic Progression]
Let $a,q$ be coprime integers. Then there are infinitely many primes $p \equiv a \mod q$.
\end{theorem}
\begin{theorem}[Siegel-Walfisz]
Let $a,q \in \Z, (a,q)=1$, and let $\pi(x;q,a)$ be the number of primes $p \leq x$ such that $p \equiv a \mod q$. 

Then for all real $B>0$ there is a constant $C_B>0$ such that:
\begin{align*}
\pi(x;q,a) = \frac{1}{\varphi(q)}\frac{x}{\log x}+O_B(x \exp(-C_B\sqrt{\log x}))
\end{align*}
whenever $q \leq (\log x)^B$.
\end{theorem}
We will not prove any of these theorems, but will study instead the Riemann zeta function and prove Chebyshev's theorem:
\begin{theorem}[Chebyshev]
There is some $c_2>c_1>0$ such that for all $x>1$, we have:
\begin{align*}
c_1 \frac{x}{\log x} \leq \pi(x) \leq c_2 \frac{x}{\log x}
\end{align*}
\end{theorem}
This will come later though. For now:
\begin{lemma}
Let $x \in \N$. Then $\pi(x) \geq \frac{\log x}{2\log 2}$
\end{lemma}
\begin{proof}
Let $p_1, \ldots, p_r$ be the primes up to $x$, so that $r = \pi(x)$. Every $n \leq x$ can be written in the form $n = k^2 \Pi_{i=1}^r p_i^{\alpha_i}$ with $\alpha_i \in \{0,1\}$ and $1 \leq k \leq \sqrt{x}$.

There are $\leq 2^r$ choices for the $\alpha_i$, and $\leq \sqrt{x}$ choices for $k$, hence $x \leq 2^{\pi(x)} \sqrt{x}$.

Rearranging, we have $\pi(x) \geq \frac{\log(x}{2\log 2}$
\end{proof}
Here let $p$ denote primes numbers. Then:
\begin{theorem}
\item
\begin{enumerate}
\item For $x \geq 5$ we have $\sum_{p\leq x} \frac{1}{p} \geq \log\log x - \frac{1}{2}$. In particular, this sum diverges.
\item For $x \geq 2$, the product $\Pi_{p\leq x} (1-\frac{1}{p})^{-1} \geq \log x$.
\end{enumerate}
\end{theorem}
\begin{proof}
For the second part, observe:
\begin{align*}
\Pi_{p\leq x} (1-\frac{1}{p})^{-1} &= \Pi_{p\leq x}(1+\frac{1}{p}+\frac{1}{p^2}+\ldots)\\
&\geq \sum_{n \leq x} \frac{1}{n}\\
&\geq \int_1^{x+1} \frac{1}{t} dt\\
&\geq \log x
\end{align*}

Then for the first part, we want to estimate the value of $\log\left(\Pi_{p\leq x}(1-\frac{1}{p})^{-1}\right) - \sum_{p\leq x}\frac{1}{p}$, or $\sum_{p\leq x}\left(\log(1-\frac{1}{p})^{-1} - \frac{1}{p}\right)$.

But note that:
\begin{align*}
\log(1-\frac{1}{p})^{-1} - \frac{1}{p} &= -\log(1-\frac{1}{p}) - \frac{1}{p}\\
&= (\frac{1}{p} + \frac{1}{2p^2} + \ldots ) -\frac{1}{p}\\
&= \frac{1}{2p^2} + \frac{1}{3p^3} + \ldots \\
&\leq \frac{1}{2p^2} + \frac{1}{2p^3} + \ldots \\
&= \frac{1}{2p^2}\left(1+\frac{1}{p}+\frac{1}{p^2}+\ldots\right)\\
&= \frac{1}{2p^2}\frac{1}{1-\frac{1}{p}}\\
&= \frac{1}{2p(p-1)}
\end{align*}
Hence:
\begin{align*}
\log\left(\Pi_{p\leq x} \left(1-\frac{1}{p}\right)^{-1}\right) - \sum_{p\leq x}\frac{1}{p} &\leq \sum_{p\leq x} \frac{1}{2p(p-1)}\\
&\leq \sum_{2\leq n\leq x} \frac{1}{2n(n-1)}\\
&= \frac{1}{2} \sum_{2\leq n\leq x} \left(\frac{1}{n-1} - \frac{1}{n}\right)\\
&= \frac{1}{2}\left(1-\frac{1}{x}\right)\\
&\leq \frac{1}{2}
\end{align*}
And so $\sum_{p\leq x}\frac{1}{p} \geq \log \Pi_{p\leq x} (1-\frac{1}{p})^{-1} - \frac{1}{2} \geq \log\log x - \frac{1}{2}$
\end{proof}

For a complex number $s$ with $\Re s > 1$, we define the \emph{Riemann zeta function} $\zeta$ as:
\begin{align*}
\zeta(s) \coloneqq \sum_{n=1}^\infty \frac{1}{n^s}
\end{align*}
Conventionally, we write $s = \sigma + \im t$ for $\sigma, t \in \R$.

\begin{lemma}
For $s \in \C$ with $\Re s > 1$, the series $\sum_{n=1}^\infty \frac{1}{n^s}$ converges absolutely. In fact, it converges uniformly on $\Re s \geq 1+\delta$ for $\delta > 0$, and is thus analytic on $\Re s > 1$.
\end{lemma}
\begin{proof}
Note $|n^s| = n^{\sigma}$, and so $\zeta(s)$ converges absolutely if and only if $\sum_{n=1}^{\infty} \frac{1}{n^{\sigma}}$ converges, which happens precisely when $\sigma > 1$.
\end{proof}

\begin{theorem}
For $s \in \C$ with $\Re s >1$, we have that $\zeta(s) = \Pi_{p prime}\left(1-\frac{1}{p^s}\right)^{-1}$.
\end{theorem}
The right hand side is known as the \emph{Euler product} for $\zeta$.
\begin{proof}[Proof (``Hand-waving")]
\begin{align*}
\Pi_{p}\left(1-\frac{1}{p^2}\right)^{-1} &= \Pi_p \left(1+p^{-s} + p^{-2s} + \ldots \right)\\
&= \sum_{n=1}^{\infty} n^{-s}
\end{align*}
since every $n$ occurs exactly once by unique factorisation.
\end{proof}
\begin{proof}
Let $s = \sigma+\im t, \sigma>1$ and consider:
\begin{align*}
\zeta(s) - \Pi_{p\leq x} (1-p^{-s})^{-1} &= \sum_{n=1}^{\infty} n^{-s} - \Pi_{p\leq x} (1+p^{-s} + p^{-2s} + \ldots)\\
&= \sum_{n\in \N_x} n^{-s}
\end{align*}
where $\N_x = \{n \in \N : $ at least one prime factor of $n$ is $> x \}$. So:
\begin{align*}
|\zeta(s) - \Pi_{p\leq x}(1-p^{-s})^{-1}| &\leq \sum_{n \in \N_x} n^{-\sigma}\\
&\leq \sum_{n > x} n^{-\sigma}\\
&\to 0 \text{ as } x \to \infty
\end{align*}
since $\zeta(s)$ converges.
\end{proof}
\begin{corollary}
Fro $s \in \C, \Re s > 1$ we have $\zeta(s) \neq 0$
\end{corollary}
\begin{proof}
Clearly, $\Pi_{p \leq X} (1-p^{-s})^{-1} \neq 0$ for $X \geq 2$. 

Now note that $\zeta(s) \Pi_{p \leq X}(1-p^{-s}) = \Pi_{p > X}(1-p^{-s})^{-1} = 1+ \sum_{n \in \N_X} n^{-s}$.

Hence $|\zeta(s) \Pi_{p\leq X}(1-p^{-s})| \geq 1-\sum_{n>X} n^{-\sigma} \to 1$.
\end{proof}
It turns out that $\zeta$ can be extended to the whole of $\C$ using an analytic continuation. First, one extends $\zeta$ to $\Re(s) > 0$ using an integral: we define the \emph{$\Gamma$-function} to be $\Gamma(z) = \int_{0}^{\infty} e^{-t}t^{z-1} dt$ for $\Re(z) > 0$. This can be continued to a meromorphic function on $\C$ with simple poles at $z = 0,-1,-2,\ldots$ and no zeroes. The $\Gamma$ function satisfies that $z\Gamma(z) = \Gamma(z-1)$.

We can then define the \emph{completed $\zeta$-function} to be
\begin{align*}
\Xi(s) = \pi^{-s/2} \Gamma(s/2) \zeta(s)
\end{align*}
for which we can prove a \emph{functional equation}
\begin{align*}
\Xi(s) = \Xi(1-s)
\end{align*}
This allows us to extend $\zeta$ to the whole of $\C$. $\zeta$ has just one pole, a simple pole at $s=1$, and it has trivial zeroes at $s=-2,-4,\ldots$. Since $\zeta(s) \neq 0$ for $\Re(s)>1$, and the zeroes of $\zeta$ must lie in the \emph{critical strip} where $0 \leq \Re(s) \leq 1$. To prove the prime number theorem one has to show that $\zeta(s) \neq 0$ for $\Re(s) = 1$.

The \emph{Riemann Hypothesis} asserts that in fact all of the zeroes of $\zeta(s)$ lie on the line $\Re(s) = \frac{1}{2}$, which is backed up by extensive numerical evidence.

Define the \emph{M\"obius function} $\mu: \N \to \{-1,0,+1\}$ by defining:
\begin{align*}
\mu(n) &= \begin{cases} (-1)^k & n = p_1p_2\ldots p_k;\; p_i \text{ all distinct}\\
0 & \ow \end{cases}\\
\mu(1) &= 1
\end{align*}
On the example sheet we will show that $\mu$ is a multiplicative function and will prove the M\"obius inversion formula:
\begin{align*}
g(n) = \sum_{d|n} f(d) \implies f(n) = \sum_{e|n} \mu(e)g(n/e)
\end{align*}
for functions $, g$ defined on $\N$

\begin{lemma}
Let $u(n) = \sum_{d|n} \mu(d)$. Then $u(n) = \begin{cases} 1 & n=1 \\ 0 & n > 0 \end{cases}$.
\end{lemma}
\begin{proof}
Assuming $\mu$ is multiplicative, we write $v(n) = \Pi_{i=1}^k u(p_i^{\alpha_i})$ if $n = \Pi_{i=1}^{k} p_i^{\alpha_i}$.

Observe that for $m \geq 0$, we have:
\begin{align*}
v(p^m) &= \mu(1) + \mu(p) + \ldots \mu(p^m) \\
&= \begin{cases} \mu(1) = 1 & m=0\\ \mu(1) + \mu(p) = 0 & m > 0\end{cases}
\end{align*}
\end{proof}
The Riemann Hypothesis is known to be equivalent to the assertion that for all $\epsilon > 0$ there is a constant $c_{\epsilon}$ such that $|\sum_{n \leq x} \mu(n) | \leq c_{\epsilon} x^{1/2 + \epsilon}$.

A \emph{Dirichlet series} is of the form $\sum_{n=1}^{\infty} \frac{a_n}{n^s}$ for some sequence $a_n \in \C$.
\begin{enumerate}
\item $\zeta(s)$
\item $\sum_{n=1}^{\infty} \legendre{n}{p}n^{-s}$, a Dirichlet L-function
\item Products of Dirichlet series, since assuming absolute convergence:
\begin{align*}
\left(\sum_{m=1}^{\infty}\frac{a_m}{m^s}\right)\left(\sum_{n=1}^{\infty}\frac{b_n}{n^2}\right) &= \sum_{m=1, n=1}^{\infty} (a_mb_n)\frac{1}{(mn)^s}\\
&= \sum_{N=1}^{\infty} c_N \frac{1}{N^s}
\end{align*}
where $c_N = \sum_{d|N} a_d b_{N/d}$. Concerning convergence, note that if $|a_n| \leq k n^{\ell}$ for some $k, \ell \in \N$, then $\sum_{n=1}^{\infty} \frac{a_n}{n^2}$ converges absolutely for $\Re(s) > k+1$.

For example. $\zeta(s) \zeta(s-1) = \left(\sum_{m=1}^{\infty} \frac{1}{m^s}\right)\left(\sum_{m=1}^{\infty}\frac{n}{n^s}\right) = \sum_{N=1}^{\infty} \frac{c_N}{N^s}$ where $c_N = \sum_{d|N}\frac{N}{d} = \sum_{d|N} d = \sigma(N)$ for $\Re(s) > 2$.
\end{enumerate}

Define the \emph{von Mangoldt function} $\Lambda: \N \to \R$ by:
\begin{align*}
\Lambda(n) = \begin{cases} \log p & n = p^k, k \geq 1,\.p\text{ prime} \\ 0 & \ow \end{cases}
\end{align*}
there are relatively few prime powers, so $\Lambda$ is to be thought of as a weighted indicator function of the primes.

One can show that $\pi(x) = \sum_{1\leq n\leq x} \one_{\text{primes}}(n) \thicksim \frac{x}{\log x}$, which is equivalent to seeing that $\Psi(x) \coloneqq \sum_{1\leq n\leq x} \Lambda(n)  \thicksim x$.

\begin{proposition}
Let $s \in \C, \Re(s) >1$. Then:
\begin{align*}
\frac{\zeta'(s)}{\zeta(s)} &= -\sum_{n=1}^{\infty} \frac{\Lambda(n)}{n^s}
\end{align*}
\end{proposition}
\begin{proof}
For $\Re(s) > 1$, we have that $\zeta(s) = \Pi_p (1-p^{-s})^{-1}$, and so $\log\zeta(s) = -\sum_{p} \log(1-p^{-s})$. Now note that $\frac{d}{ds}p^{-s} = \frac{d}{ds}e^{-s\log p} = -\log(p) p^{-s}$.

Therefore, differentiating both sides, we have:
\begin{align*}
\frac{\zeta'(s)}{\zeta(s)} &= -\sum_p \frac{(\log p) p^{-s}}{1-p^{-s}} \\
&= -\sum_p (\log p) \sum_{j=1}^{\infty} p^{-js} \\
&= -\sum_{n=1}^{\infty} \frac{\Lambda(n)}{n^s}
\end{align*}
\end{proof}

Then integrating $\frac{\zeta'(s)}{\zeta(s)}\frac{x^s}{s}$ around a contour, one can show that:
\begin{align*}
\Psi(x) = \frac{1}{2\pi\im}\int_{c-\im \infty}^{c+\im\infty} \left(-\frac{\zeta'(s)}{\zeta(s)}\frac{x^s}{s}\right) ds
\end{align*}
Then, shifting the contour to the left, this is equal to:
\begin{align*}
= x - \sum_{p:\zeta(p) = 0} \frac{x^p}{p}-\frac{\zeta'(0)}{\zeta(0)} - \frac{1}{2}\log\left(1-\frac{1}{x^2}\right)
\end{align*}

\begin{theorem}
Let $X>1$ and let $P = \Pi_{p\leq \sqrt{X}}p$. Then $\pi(X)-\pi(\sqrt{X})+1 = \sum_{d|P}\mu(d)\floor{\frac{X}{d}}$
\end{theorem}
\begin{proof}
By the sieve of Eratosthenes, if we delete from $\{2,3,\ldots, X\}$ all multiples of primes $\leq \sqrt{X}$, we are left with $\{p : \sqrt{X} < p \leq X\}$. \\
Hence we have that $\{1\leq n\leq X:(n,P) = 1\} = \{1\}\cup\{p:\sqrt{X}<p\leq X\}$.\\
So $\pi(X)-\pi(\sqrt{X}) + 1 = \#\{1\leq n\leq X: (n,P) = 1\}$.
Also, by lemma \textbf{5.10}, $\sum_{d|n} \mu(d) = \begin{cases} 1 & n=1 \\ 0 & n>1\end{cases}$. Hence:
\begin{align*}
\#\{1\leq n \leq X: (n,P) = 1\} &= \sum_{1\leq n\leq X} \sum_{d|(n,P)} \mu(d) \\
&= \sum_{d|P} \sum_{1\leq n\leq X, n \equiv 0 \mod d} \mu(d)\\
&= \sum_{d|P} \mu(d) \sum)_{1\leq n \leq X, n\equiv 0 \mod d} 1\\
&= \sum_{d|P} \mu(d) \floor{\frac{X}{d}}
\end{align*}
\end{proof}
The next two results use divisibility propertied of binomial coefficients
\begin{theorem}[Tchebychev]
$\exists c_2 > c_1 > 0 \st \forall x \geq 2:$
\begin{align*}
c_1 \frac{x}{\log x} \leq \pi(x) \leq c_2 \frac{x}{\log x}
\end{align*}
Where we can take $c_1 = \frac{\log 2}{2} \approx 0.346\ldots$, and $c_2 = 6\log 2 \approx 4.158\ldots$ for $x \geq 4$.
\end{theorem}
\begin{proof}[Proof of upper bound.]
We shall sandwich $n \in \N$ between two powers of $2$.

We first prove by induction on $k$ that $\pi(2^k) \leq 3\cdot\frac{2^k}{k} (\dagger)$ for $k \geq 1$.

Observe that, for even $x \geq 4$, $\pi(x) \leq \frac{x}{2}$, so $\pi(2^k) \leq 2^{k-1} \leq 3\cdot \frac{2^k}{k}$ whenever $k \leq 6$.

Let $n \in \N, N = \binom{2n}{n} < 2^{2n}$. Then $N \geq \Pi_{n<p\leq 2n}p$ since every prime in this product divides the numerator once and doesn't divide the denominator, and so $\geq n^{\pi(2n)-\pi(n)}$

So $\pi(2n)-\pi(n) \leq \frac{\log(2^{2n})}{\log n} = 2\log 2\frac{n}{\log n}$. Assuming the inductive hypothesis $(\dagger)$ for $k$
\begin{align*}
\pi(2^{k+1}) &\leq \pi(2^k) + 2\log 2 \frac{2^k}{\log 2^k}\\
&= \pi(2^k) + \frac{2^{k+1}}{k}\\
&\leq 3 \cdot \frac{2^k}{k} + \frac{2^{k+1}}{k}\\
&= 5 \cdot \frac{2^k}{k} = 5\cdot \frac{2^{k+1}}{2k}\\
&\leq 3\cdot \frac{2^{k+1}}{k+1}
\end{align*}
for $k \geq 5$. Hence $(\dagger)$ holds for all $k\geq 1$. Moreover, $\frac{d}{dx}\left(\frac{x}{\log x}\right) = \frac{\log x - 1}{(\log x)^2} > 0$, so $\frac{x}{\log x}$ is monotonic increasing for $x \geq e$. So if $4 \leq 2^k < x \leq 2^{k+1}$, then $\pi(x) \leq \pi(2^{k+1}) \leq 6\cdot \frac{2^k}{k+1} < 6 \log 2 \frac{2^k}{\log(2^k)} < 6\log 2 \frac{x}{\log x}$.
\end{proof}
Let $n \geq 1$, $p$ a prime. Define the \emph{p-adic valuation of n} as $v_p(n)$, the exponent of $p$ in the factorisation of $n$.

Clearly $n = p^{v_p(n)}n_0$ with $(n_0,p) = 1$, and $v_p(nm) = v_p(n) + v_p(m)$. Question 6 on sheet 3 will show that $v_p(n!) = \sum_{i=1}^{\infty} \floor{\frac{n}{p_i}}$
\begin{lemma}
Let $n \in \N, N = \binom{2n}{n}$. Then:
\begin{enumerate}
\item If $\frac{2n}{3} < p \leq 2n$, then $(N,p) = 1$
\item If $p^k | N$ for some $k \geq 1$ then $p^k \leq 2n$.
\end{enumerate}
\end{lemma}
\begin{proof}
\item
\begin{enumerate}
\item If $p \in (\frac{2n}{3}, n]$, then $p \leq n < 2p \leq 2n < 3p$. Hence both the denominator and numerator of $N = \binom{2n}{n}$ are divisible by exactly one copy of $p$
\end{enumerate}
\end{proof}
\begin{proof}[Proof of lower bound]
Let $n \in \N, N = \binom{2n}{n} = \prod_{p\leq 2n}p^{v_p(N)}$. By the previous lemma, we have $p^{v_p(N)} \leq 2n$, and so $v_p(N) \leq \frac{\log 2n}{\log p}$.

It then follows from this that:
\begin{align*}
\log N &= \sum_{p\leq 2n} v_p(N) \log p\\
&\leq \sum_{p\leq 2n} \frac{\log 2n}{\log p}\log p\\
&= \pi(2n) \log 2n
\end{align*}
So we need a lower bound on $N$. Note that $2^{2n} = (1+1)^{2n} = \sum_{j=0}^{2n} \binom{2n}{j} = 2 + \sum_{j=1}^{2n-1} \binom{2n}{j} \leq 2 + (2n-1)N \leq 2nN$

So we have $\pi(2n) \geq \frac{\log N}{\log 2n} \geq \frac{\log(2^{2n}) - \log 2n}{\log 2n} = \log 2 \frac{2n}{\log 2n} - 1$

So if $2n < x \leq 2n+2$, we have $\pi(x)\geq \pi(2n) \geq \log 2\frac{x-2}{\log x} - 1 \geq \frac{\log 2}{2}\frac{x}{\log x}$
\end{proof}

\begin{theorem}[Bertrand's Postulate]
For all $n > 1$ there is a prime $p \in [n, 2n)$.
\end{theorem}
For this, we need a lemma: for $x \geq 1$, let $P(x) = \prod_{p\leq x} p$. Then $P(x) \leq 4^x$ for all $x \geq 1$.
\begin{proof}
By induction on $n$, noting that $P(x) = P(\floor{x})$. Firstly, note that $P(2) \leq 4^2, P(3) \leq 4^3$.

For $n\geq 1$, $P(2n+1) = P(2n+1) = \prod_{p\leq n+1} p \cdot \prod_{n+1\leq p\leq 2n+1} p = P(n+1) \cdot \prod_{n+1 \leq p\leq 2n+1} p$.

Now clearly $\prod_{n+2\leq p\leq 2n+1}p$ divides $\binom{2n+1}{n}$ since each prime $p \in [n+2, 2n+1]$ divides $\binom{2n+1}{n}$. 

Moreover, $2\binom{2n+1}{n} = \binom{2n+1}{n} + \binom{2n+1}{n+1} < \sum_{j=0}^{2n+1} \binom{2n+1}{j} = 2^{2n+1}$, so $\binom{2n+1}{n}\leq 4^n$.

It then follows that $P(2n+2)=P(2n+1)\leq P(n+1)\cdot 4^n \leq 4^{n+1}\cdot 4^n = 4^{2n+1}$.
\end{proof}
\begin{proof}[Proof of Bertrand's Postulate]
Suppose $\nexists p \in [n,2n)$. Let $N = \binom{2n}{n}$. Then if $p|N$, we have $p \leq \frac{2n}{3}$ by \textbf{5.14}, and also $p^{v_p(N)} \leq 2n$ for all $p$.

Write $N = N_1 \cdot N_2$ with $N_1 = \prod_{v_p(N) = 1} p$, $N_2 = \prod_{v_p(N) \geq 2} p$.

Then $N_1 \leq \prod_{p\leq 2n/3} p = P(2n/3) \leq 4^{2n/3}$\\
And $N_2 = \prod_{v_p(N)\geq 2} p^{v_p(N)} \leq \prod_{p\leq \sqrt{2n}} 2n \leq (2n)^{\sqrt{2n}}$

Hence $\frac{2^{2n}}{2n} \leq N \leq 4^{2n/3} \cdot(2n)^{\sqrt{2n}}$, and so
\begin{align*}
2^{2n/3} \leq (2n)^{1+\sqrt{2n}} \implies \frac{\log 2}{3} (2n) \leq (1+\sqrt{2n})\log(2n)
\end{align*}
which is obviously false for large values of $n$, e.g. $n = 2^9$.

For smaller values of $n$, consider the list of primes $p=2,5,11,23,47,89,179,359,719$, where each $p_i$ is the largest prime $\leq 2(p_{i-1}+1)$.
\end{proof}

\section{Continued Fractions}
We want to find good rational approximations for irrational numbers, where $|\pi - \frac{p}{q}|$ small relative to $q$, e.g. $335/113$. We define a possibly finite sequence of integers $a_0, a_1, a_2, \ldots$ with $a_n \geq 1$ for $n \geq 1$ as follows:
\begin{enumerate}
\item Let $a_0 = \floor{\theta}$. If $\theta = a_0$, \textsc{Halt}. Otherwise, let $\theta_1 = 1/{\theta - a_0} > 1$.
\item Let $a_1 = \floor{\theta_1} \geq 1$. Stop if $\theta_1 = _1$. Otherwise let $\theta_2 = \frac{1}{\theta_1 - a_1} > 1$, and repeat.
\end{enumerate}
If this algorithm stops at step $n$, then we write $\theta = [a_0;a_1,a_2,\ldots, a_n]$, otherwise, we write $\theta = [a_0;a_1,a_2,\ldots,a_{n-1},\theta_n]$.

We call this the \emph{continued fraction expansion} of $\theta$. The $a_i$ are known as the \emph{partial quotients} and the $\theta_i$ are the \emph{complete quotients} for $\theta$.

For instance, $\theta = \frac{59}{13} = 4 + \frac{7}{13} = 4 + \frac{1}{1+\frac{6}{7}} = 4  + \frac{1}{1+\frac{1}{1+\frac{1}{6}}}$

\begin{proposition}
The CFE of $\theta \in \R$ terminates iff $\theta \in \Q$.
\end{proposition}
\begin{proof}
Only if is clear.

Suppose $\theta = \frac{b_0}{c_0} \in \Q$. Then each $\theta_i$ is also in $\Q$, say $\theta_i = \frac{b_i}{c_i}$ in lowest terms. Then $\theta_i = a_i + \frac{1}{\theta_{i+1}}$, so $b_{i+1} = c_i < b_i$, and so the $b_i$ strictly decrease but are positive, so it terminates.
\end{proof}
Note that if $\frac{b_i}{c_i} = a_i + \frac{c_{i+1}}{b_{i+1}}$ then $b_i = a_ib_{i+1} + b_{i+2}$, so all we're really doing is Euclid's algorithm on $(b_0, c_0)$.

Let $a_0, a_1, \ldots$ be integers with $a_n \geq 1$. We define the \emph{convergents} of the continued fraction expansion $[a_0;a_1,a_2,\ldots]$ as pairs of integers $(p_n, q_n)$ for $n\geq 0$ as follows:\\
$p_0 = a_0, p_1 = a_0a_1 +1, p_n = a_np_{n-1} + p_{n-2}$\\
$q_0 = 1, q_1 = a_1, q_n = a_nq_{n-1} + q_{n-1}$

Note that $1 \leq q_1 < q_2 < \ldots$ is an increasing sequence of positive integers tending to $\infty$. We can also write this in matrix form, and sometimes let $p_{-1} = 1, q_{-1} = 0$, giving:
\begin{align*}
\begin{pmatrix}
p_n & p_{n-1} \\ q_n & q_{n-1}
\end{pmatrix} = \begin{pmatrix}
a_0 & 1 \\ 1 & 0
\end{pmatrix}\begin{pmatrix}
a_1 & 1 \\ 1  0
\end{pmatrix}\cdots\begin{pmatrix}
a_n & 1 \\ 1 & 0
\end{pmatrix}
\end{align*}
\begin{proposition}
\item
\begin{enumerate}
\item $(p_n, q_n) = 1$, and in fact $p_nq_{n-1} - p_{n-1}q_n = (-1)^{n-1}$
\item $[a_0;a_1, a_2, \ldots, a_n] = \frac{p_n}{q_n}$
\item If $\alpha = [a_0;a_1,\ldots,a_{n-1}\beta]$ for some real $\beta > 0$, then $\alpha$ lies strictly between $\frac{p_n}{q_n}$ and $\frac{p_{n-1}}{q_{n-1}}$
\end{enumerate}
\end{proposition}
\begin{proof}
\item
\begin{enumerate}
\item Take the determinant of the matrix and this appears
\item By induction on $n$ - base case is immediate. For induction step, just do manual manipulation.
\item By induction on $n$ - base case is immediate. Let $n >0$ and set $\gamma = a_n + \frac{1}{\beta}$. By the induction hypothesis:
\begin{align*}
\alpha = [a_0;a_1,\ldots, a_{n-1},\gamma] &= \frac{p_{n-}\gamma + p_{n-1}}{q_{n-1}\gamma + q_{n-2}}\\
&= \frac{p_{n-1}(a_n\beta + 1) + \beta p_{n-2}}{q_{n-1}(a_n \beta + 1) + \beta q_{n-2}}\\
&= \frac{(a_np_{n-1} + p_{n-2})\beta + p_{n-1}}{(a_nq_{n-1} + q_{n-2})\beta + q_{n-1}}\\
&= \frac{p_n \beta + p_{n-1}}{q_n \beta + q_{n-1}}
\end{align*}
Finally, if $\frac{x}{y} < \frac{x'}{y'}$ with $y,y'>0$ then $\frac{x}{y} < \frac{x+x'}{y+y'} < \frac{x'}{y'}$, and so we are done. 
\end{enumerate}
\end{proof}
\begin{theorem}
Let $\theta \in \R$ be irrational with $[a_0;a_1,a_2,\ldots]$. Then $\forall n \geq 0, |\theta - \frac{p_n}{q_n}| < \frac{1}{q_n q_{n-1}}$. In particular $\frac{p_n}{q_n} \to 0$ as $n \to \infty$.
\end{theorem}
\begin{proof}
$|\frac{p_n}{q_n} - \frac{p_{n+1}}{q_{n+1}}| = |\frac{p_nq_{n+1} - p_{n+1}q_n}{q_nq_{n+1}}| = |\frac{(-1)^n}{q_nq_{n+1}}| = \frac{1}{q_nq_{n+1}}$

Then write $\theta  = [a_0;a_1, a_2, \ldots, a_{n+1}, \theta_{n+2}]$, and we see that $\theta$ lies between $\frac{p_n}{q_n}$ and $\frac{p_{n+1}}{q_{n+1}}$.

Hence $|\theta - \frac{p_n}{q_n}| < \frac{1}{q_nq_{n+1}}$. Then observing that $q_n \to \infty$ gives the last part of the statement.
\end{proof}
As a result of this theorem, we can think of $\theta = [a_0;a_1,\ldots] = \lim_{n\to \infty} [a_0;a_1,\ldots,a_n]$.

If we fix a denominator $q \geq 1$ and try to minimise $|\theta - \frac{p}{q}|$, the best we can expect in general is $\frac{1}{2q}$, where $p$ is the closest integer to $\theta q$.

\begin{theorem}
Let $\theta \in \R$, and suppose that $(p_n, q_n)$ are convergents for the CFE of $\theta$.

Suppose $q \in \N$ with $1 \leq q < q_{n+1}$ for some $n \in \N$. Then for all $p \in \Z, |q \theta - p| \geq |q_n \theta - p_n|$. 

Moreover, if $q \in \N, p\in \Z$ are are such that $|\theta - \frac{p}{q}| < |\theta-\frac{p_n}{q_n}|$, then $q > q_n$.
\end{theorem}

\begin{proof}
For the ``moreover" part, suppose that $q \leq q_n$. Then the first part of the theorem implies that $|\theta - \frac{p}{q}| \geq \frac{1}{q}|q_n\theta - p_n| = \frac{q_n}{q}|\theta-\frac{p_n}{q_n}| \geq | \theta - \frac{p_n}{q_n}| \contr.$

Now let $q \in \N, p \in \Z$ with $1\leq q < q_{n+1}$ for some $n \in \N$. Consider the system of equations $p_nu + p_{n+1}v = p; q_n u + q_{n+1} v = q$.

Then we have that $\det \begin{pmatrix} p_n & p_{n+1} \\ q_n & q_{n+1} \end{pmatrix} = (-1)^n$, so this system has a unique solution $(u,v)$ with $u,v \in \Z$ not both 0.

Thus $q \theta -p = q_n u + q_{n+1} v)\theta - (p_n u + p_{n+1}v) = (q_n \theta - p_nu) + (q_{n+1}\theta - p_{n+1})v$.

If $v = 0$, then $|q\theta - p| = |q_n \theta - p_n||u| \geq |q_n\theta - p_n|$.

We may assume $v \neq 0$. By the second equation, $u \neq 0$ and has the opposite sign to $v$.

Also, $\theta - \frac{p_n}{q_n}$ and $\theta -\frac{p_{n+1}}{q_{n+1}}$ have opposite signs, and it follows that $(q_n \theta - p_n)u$ and $(q_{n+1}\theta-p_{n+1})v$ have the same sign.

So $|q\theta-p| = |(q_n\theta-p_n)u| + |(q_{n+1}\theta-p_{n+1})v| \geq |(q_n\theta-p_n)u| \geq |q_n\theta - p_n|$.
\end{proof}

\begin{theorem}
Let $\theta \in \R\setminus \Q$, and suppose that $(p_n, q_n)$ are the convergents for the CFE of $\theta$. Then:
\begin{enumerate}
\item At least one of any pair of consecutive convergents satisfies $|\theta-\frac{p}{q}| < \frac{1}{2q^2}$.
\item If $\frac{p}{q} \in \Q$ is such that $|\theta-\frac{p}{q}| < \frac{1}{2q^2}$, then $p/q = p_n/q_n$ for some $n$.
\end{enumerate}
\end{theorem}
\begin{proof}
\item
\begin{enumerate}
\item Suppose that for some $n \in \N$, $|\theta-\frac{p_n}{q_n}| \geq \frac{1}{2q_n^2}$ and $|\theta - \frac{p_{n+1}}{q_{n+1}}|\geq \frac{1}{2q_{n+1}^2}$.

Then $\frac{1}{2}\left(\frac{1}{q_n^2} + \frac{1}{q_{n+1}^2}\right) \leq |\theta-\frac{p_n}{q_n}| + |\theta - \frac{p_{n+1}}{q_{n+1}}| = |\frac{p_n}{q_n} - \frac{p_{n+1}}{q_{n+1}}| = \frac{1}{q_nq_{n+1}}$, contradicting AMGM \contr.

\item Suppose $\frac{p}{q} \in \Q$ with $|\theta-\frac{p}{q}| < \frac{1}{2q^2}$. Then there is some $n \geq 0$ such that $q_n \leq q < q_{n+1}$. We claim that $\frac{p}{q} = \frac{p_n}{q_n}$, because if not, then $\frac{1}{qq_n} \leq |\frac{p}{q} - \frac{p_n}{q_n}| \leq |\theta - \frac{p}{q}| + |\theta-\frac{p_n}{q_n}| = \frac{1}{q}|\theta q - p| + \frac{1}{q_n}|\theta q_n-p_n|$, and so $q < q_n$ \contr.
\end{enumerate}
\end{proof}

A CFE of the form $[a_0;a_1,\ldots,a_n,\ldots,a_{n+k},a_n,\ldots,a_{n+k},a_n,\ldots]$ is called \emph{eventually periodic}, and is abbreviated as $[a_0;a_1,\ldots,\overline{a_n,\ldots,a_{n+k}}]$. It is called \emph{purely periodic} if $n=0$, and the \emph{period} is the least positive integer $k+1$ such that this happens.

\begin{theorem}[Lagrange]
The CFE of $\theta \in \R\setminus \Q$ is eventually periodic if and only if $\theta$ is a quadratic irrational.
\end{theorem}
\begin{proof}
Suppose $\phi = [\overline{a_0;a_1,\ldots,a_n}]$ is purely periodic. Then $\phi = [a_0,a_1,\ldots,a_n,\phi] = \frac{p_n \phi + p_{n-1}}{q_n \phi + q_{n-1}}$. So $\phi^2 + (q_{n-1}-p_n)\phi-p_{n-1} = 0$, and so $\phi$ is a quadratic irrational.

We then observe quadratic irrationals are closed under division, multiplication, addition, and so if $\phi$ is eventually periodic, the periodic part is quadratic irrational and so $\phi$ is also.

Conversely, if $a\theta^2+b\theta+c=0$. Then let $f = (a,b,c)$ be a BQF which we can write as $f(x,y) = a(x-\theta y)(x-\theta'y)$, where $\theta'$ is the conjugate root of this quadratic.

Then let $f_n(x,y) = f(p_nx+p_{n-1}y, q_nx+q_{n-1}y) = (a_n,b_n,c_n)$. We shall see that the complete quotients $\theta_n$ of $\theta$ arise a solutions to $f_{n-1}(x,1)=0$, and that there are only finitely many forms $f_n$.

First observe that $\disc(f_n) = \disc(f) = D$. Also $\theta = \frac{p_n\theta_{n+1}+p_{n-1}}{q_n\theta_{n+1}+q_{n-1}}$, so $f_n(\theta_{n+1},1) = (q_n\theta_{n+1}+q_{n-1})^2f(\theta,1) = 0$. Now observe that $|f(p_n,q_n)| \leq 2a|\theta-\theta'|$, so it follows that $f_n(1,0) = f(p_n,q_n) = a_n$, and $f_{n+1}(0,1) = f(p_n,q_n) = c_{n+1}$ are both bounded above. So there are finitely many distinct $f_n$, and so $f_{n+k} = f_n$. Hence the set of complete quotients is finite, and so the CFE is eventually periodic.
\end{proof}
\begin{theorem}[Galois]
$\theta$ has a purely periodic CFE if and only if $\theta > 1$ and $\theta' \in (-1,0)$.
\end{theorem}
\begin{corollary}
If $\d \in \N$ is not a square, then $\sqrt{d} = [a_0;\overline{a_1,\ldots,a_m}]$.
\end{corollary}
\begin{proof}
$\theta_1 = \frac{1}{\sqrt{d}-a_0} > 1$, with its conjugate root $\theta_1' = \frac{1}{-\sqrt{d}-a_0} \in (-1,0)$.
\end{proof}
In fact it is the case that $\sqrt{d} = [a_0;\overline{a_1,a_2,\ldots,a_2,a_1,2a_0}]$.
\begin{theorem}[Pell's Equation]
If $d \in \N$ is not a square then $x^2 - dy^2 = 1$ has a solution in integers $x, y \neq 0$.
\end{theorem}
\begin{proof}
Let $\theta = \sqrt{d} = [a_0;a_1,\ldots, a_n, \theta_{n+1}]$ with $\theta_1=\theta_{n+1}$.

So $\sqrt{d} = \frac{p_n\theta_{n+1}+p_{n-1}}{q_n\theta_{n+1}+q_{n-1}} = \frac{p_n+p_{n-1}(\sqrt{d}-a_0)}{q_n+q_{n-1}(\sqrt{d}-a_0)}$ and so $q_{n-1}d + (q_n-q_{n-1}a_0)\sqrt{d} = p_n - a_0p_{n-1}+p_{n-1}\sqrt{d}$.

Comparing coefficients, we have $p_{n-1}^2 - dq_{n-1}^2 = q_np_{n-1}-p_nq_{n-1} = (-1)^n$.

And so if $n$ is even then $(x,y)=(p_{n-1},q_{n-1})$ is a solution to Pell's equation. If $n$ is odd, then $(p_{2n-1},q_{2n-1})$ is a solution.
\end{proof}
Indeed, one can prove that any solution to Pell's equation must be a convergent of $\sqrt{d}$.

\underline{Examples:}
\begin{enumerate}
\item Solve $x^2-6y^2 = 1$. We first compute $\sqrt{6} = [2; \overline{2,4}]$. Then $p_1/q_1 = 5/2$, giving $5^2-6\cdot 2^2 = 1$.
\item Solve $x^2-17y^2 = -1$. We have $\sqrt{17} = [4;\overline{8}]$. Then $p_0/q_0 = 4/1$, and $4^2-17\cdot 1^2 = -1$.
\end{enumerate}

\section{Primality Testing and Prime factorisation}
Given a large integer $N$ we want to determine efficiently if $N$ is prime, and if $N$ is not prime find a prime factor.

It turns out that we can do the former, but as far as we know we cannot do the latter. We will usually assume $N$ is odd. Fermat's little theorem can tell us if $N$ is not prime. Recall that, if $(a,p)=1$, then $a^{p-1} \equiv 1 \mod p$. 

\begin{enumerate}
\item $N = 15$. $2^{14} = (2^4)^3\cdot 2^2 = 16^3\cdot 4 \equiv 4 \mod 15$, so $15$ is not prime.

\item $N=10$. $3^90 \equiv 1 \mod 91$, but $91=7\cdot 13$ is composite. Using base $2$, we have $2^90 \equiv 64 \mod 91$, and we conclude that one base alone is not sufficient. 
\end{enumerate}

Let $b \in \N$. An odd composite integer $N >1$ with $(b,N) > 1$ is a \emph{(Fermat) pseudoprime to base b} is $b^{N-1} \equiv 1 \mod N$. Note that this definition only depends on $b \mod N$, so it is sufficient to consider bases $1 \leq b < N$. For instance, 91 is a Fermat pseudoprime to base $3$.

\begin{proposition}
Let $N > 1$. If $N$ is not a pseudoprime to some base $b_0$, then for at least half of $\{1 \leq b < N : (b,N) = 1\}$, it is not a pseudoprime to base $b$.
\end{proposition}
\begin{proof}
Note that the set of bases to which $N$ is a pseudoprimes is closed under multiplication: $b_1^N \equiv 1 \equiv b_2^N \mod N \implies (b_1b_2)^N \equiv 1 \mod N$.

It follows that $B = \{1 \leq b < N: (b,N) = 1, N$ is pseudoprime to base $b\}$ is a subgroup of $(\Z/N\Z)^{\times}$. But $b_0 \notin B$, so $B$ is a proper subgroup of index $\geq 2$.
\end{proof}

If $N$ is not pseudoprime to any base, we can determine this in practice by checking a relatively small number of bases. But it turns out that there are composite $N$ which is pseudoprime to ever base.

An odd composite integer $N > 1$ is a \emph{Carmichael number} if it is pseudoprime to every base. It has been shown that there are infinitely many Carmichael numbers.

Recall that, if $(a,p)=1$, then $a^{(p-1)/2} \equiv \legendre{a}{p} \mod p$.

Let $b \in \N$. An odd composite integer $N >1$ is said to be an \emph{Euler pseudoprime to base b} if $b^{(N-1)/2} \equiv \legendre{b}{N} \mod N$. Squaring both sides shows immediately that every Euler pseudoprime to base $b$ is a Fermat pseudoprime to base $b$.

\begin{proposition}
If $N<1$ is not an Euler pseudoprime to some base $b_0$ then it is not an Euler pseudoprime to at least half the bases $\{1\leq b<N : (b,N) = 1\}$.
\end{proposition}
\begin{proof}
Same as for Fermat.
\end{proof}
\begin{theorem}
If $N<1$, odd, composite, then there is some base such that $N$ is not an Euler pseudoprime to base $b$.
\end{theorem}
\begin{proof}
Suppose first that $N$ is square free. Let $N = p\cdot m$ with some prime $p, m \geq 3, p\nmid m$.

Pick $u \in \Z \st \legendre{u}{p}=-1$. Then by the CRT, $\exists b \in \Z \st b >1, b \equiv u \mod p, b \equiv 1 \mod m$.

Then $\legendre{b}{N} = \legendre{b}{p}\legendre{b}{m} = \legendre{u}{p}\legendre{1}{m} = -1$.

But since $ b \equiv 1 \mod m, b^{(N-1)/2} \equiv 1 \nequiv -1 \mod m$. So $b^{(N-1)/2} \nequiv -1 \mod N$.
\end{proof}

This gives us the following probabilistic test:\\
\textbf{\underline{Solvay-Strassen Primality Test}}

Given odd $N > 1$, pick $1 \leq b <N$ at random. Check if $(b,N) = 1$ - if this fails then $N$ is composite. Then compute $b^{(N-1)/2}$ by repeated squaring, and $\legendre{b}{N}$ by repeated squaring, and $\legendre{b}{N}$ by reciprocity law. Then check if $b^{(N-1)/2} \equiv \legendre{b}{N} \mod N$. If not, then $N$ is composite. Otherwise, $N$ is composite with probability $\leq 1/2$.

If $N$ passes $k$ iterations of this test, then $N$ is composite with probability $1/2^k$.
\end{document}